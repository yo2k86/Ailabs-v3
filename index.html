<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Labs Pro Suite v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- BARU: Menambahkan skrip ikon Lucide -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        :root {
            --neon-orange: #FF8C00;
            --neon-blue: #00BFFF;
            --neon-green: #39FF14;
            --dark-bg: #0A0A0A;
            --mid-bg: #1A1A1A;
            --light-bg: #2A2A2A;
            --text-color: #E5E7EB;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            background-image: radial-gradient(circle at 10% 10%, var(--neon-blue) 0%, transparent 15%),
                              radial-gradient(circle at 90% 80%, var(--neon-orange) 0%, transparent 15%);
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-attachment: fixed;
            scroll-behavior: smooth; /* BARU: Ditambahkan dari aplikasi Remix */
        }

        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }

        /* --- Efek Neon --- */
        .neon-text-orange {
            text-shadow: 0 0 5px rgba(255, 120, 0, 0.7),
                         0 0 10px rgba(255, 120, 0, 0.7),
                         0 0 20px rgba(255, 120, 0, 0.5);
        }
        
        .neon-text-blue {
            color: #00BFFF;
            text-shadow: 0 0 5px rgba(0, 191, 255, 0.7),
                         0 0 10px rgba(0, 191, 255, 0.7),
                         0 0 20px rgba(0, 191, 255, 0.5);
        }

        .neon-text-green {
            color: #39FF14;
            text-shadow: 0 0 5px rgba(57, 255, 20, 0.7),
                         0 0 10px rgba(57, 255, 20, 0.7),
                         0 0 20px rgba(57, 255, 20, 0.5);
        }

        /* --- Glass Card Effect --- */
        .glass-card {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 120, 0, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 
                        0 0 15px rgba(255, 120, 0, 0.1);
            transition: all 0.3s ease-in-out;
        }
        
        /* --- Input/Select/Textarea Styling --- */
        .neon-input {
            background-color: var(--mid-bg);
            border: 1px solid rgba(255, 120, 0, 0.3);
            transition: all 0.3s ease;
            color: var(--text-color);
        }
        .neon-input:focus {
            outline: none;
            border-color: var(--neon-orange);
            box-shadow: 0 0 0 2px rgba(255, 120, 0, 0.5);
            background-color: var(--light-bg);
        }
        .neon-input::placeholder {
            color: #6b7280;
        }

        select.neon-input {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%2Bxmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%2Bwidth%3D%22292.4%22%2Bheight%3D%22292.4%22%3E%3Cpath%2Bfill%3D%22%239CA3AF%22%2Bd%3D%22M287%2B69.4a17.6%2B17.6%2B0%2B0%2B0-13-5.4H18.4c-5%2B0-9.3%2B1.8-12.9%2B5.4A17.6%2B17.6%2B0%2B0%2B0%2B0%2B82.2c0%2B5%2B1.8%2B9.3%2B5.4%2B12.9l128%2B127.9c3.6%2B3.6%2B7.8%2B5.4%2B12.8%2B5.4s9.2-1.8%2B12.8-5.4L287%2B95c3.5-3.5%2B5.4-7.8%2B5.4-12.8%2B0-5-1.9-9.4-5.4-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 0.65rem;
            padding-right: 2.5rem;
        }

        /* --- Buttons Styling --- */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .btn-neon-orange {
            background-color: var(--neon-orange);
            color: var(--dark-bg);
            box-shadow: 0 0 10px rgba(255, 120, 0, 0.6), 0 0 20px rgba(255, 120, 0, 0.4);
        }
        .btn-neon-orange:hover {
            background-color: #FFA500;
            box-shadow: 0 0 15px rgba(255, 120, 0, 0.8), 0 0 30px rgba(255, 120, 0, 0.6);
            transform: translateY(-2px);
        }
        .btn-neon-green {
            background-color: var(--neon-green);
            color: var(--dark-bg);
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.6), 0 0 20px rgba(57, 255, 20, 0.4);
        }
        .btn-neon-green:hover {
            background-color: #4CFF2E;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.8), 0 0 30px rgba(57, 255, 20, 0.6);
            transform: translateY(-2px);
        }
        .btn-neon-blue {
            background-color: var(--neon-blue);
            color: var(--dark-bg);
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.6), 0 0 20px rgba(0, 191, 255, 0.4);
        }
        .btn-neon-blue:hover {
            background-color: #24CFFF;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.8), 0 0 30px rgba(0, 191, 255, 0.6);
            transform: translateY(-2px);
        }
        .btn:disabled {
            background-color: #444;
            color: #888;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        .btn-ghost-neon {
            background-color: transparent;
            border: 2px solid var(--neon-orange);
            color: var(--neon-orange);
            box-shadow: 0 0 8px rgba(255, 120, 0, 0.3);
        }
        .btn-ghost-neon:hover {
            background-color: rgba(255, 120, 0, 0.1);
            box-shadow: 0 0 15px rgba(255, 120, 0, 0.6);
            transform: translateY(-2px);
        }
        
        .btn-ghost-green {
            background-color: transparent;
            border: 2px solid var(--neon-green);
            color: var(--neon-green);
            box-shadow: 0 0 8px rgba(57, 255, 20, 0.3);
        }
        .btn-ghost-green:hover {
            background-color: rgba(57, 255, 20, 0.1);
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.6);
            transform: translateY(-2px);
        }

        /* --- Spinner --- */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--neon-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite, pulse-neon-green 1.5s ease-in-out infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes pulse-neon-green {
            0%, 100% {
                box-shadow: 0 0 5px var(--neon-green), 0 0 10px var(--neon-green);
            }
            50% {
                box-shadow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green);
            }
        }
        
        /* --- Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--dark-bg); }
        ::-webkit-scrollbar-thumb {
            background: var(--neon-orange);
            border-radius: 4px;
            box-shadow: 0 0 5px var(--neon-orange);
        }
        ::-webkit-scrollbar-thumb:hover { background: #FFA500; }

        /* --- Custom Step Connector --- */
        .step-connector {
            position: relative;
            text-align: center;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
        }
        .step-connector::before {
            content: '';
            position: absolute;
            left: 50%;
            top: -1.5rem;
            transform: translateX(-50%);
            width: 2px;
            height: 1.5rem;
            background: linear-gradient(to bottom, var(--neon-orange), var(--neon-blue), var(--neon-green));
            opacity: 0.5;
        }
        .step-icon {
            display: inline-block;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: var(--mid-bg);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue);
            color: var(--neon-blue);
            font-size: 1.5rem;
            line-height: 2.8rem;
            font-weight: 700;
        }

        /* --- Styles for Upscaler App --- */
        .card-glow {
            position: relative;
            border: 1px solid #00d9ff44;
            background: linear-gradient(145deg, rgba(10, 10, 30, 0.6), rgba(20, 20, 40, 0.8));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .drop-zone-border {
            border: 2px dashed #00d9ff88;
            transition: all 0.3s ease;
        }

        .drop-zone-border.dragover {
            border-color: #d000ff;
            background-color: rgba(208, 0, 255, 0.1);
        }

        .btn-futuristic {
            background: linear-gradient(90deg, #00d9ff, #d000ff);
            transition: all 0.3s ease;
            box-shadow: 0 0 15px #00d9ff88, 0 0 15px #d000ff88;
        }

        .btn-futuristic:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px #00d9ff, 0 0 25px #d000ff;
        }
        
        .btn-download {
            background: linear-gradient(90deg, #10b981, #0ea5e9);
            transition: all 0.3s ease;
            box-shadow: 0 0 15px #10b98188;
        }
        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px #10b981;
        }

        /* Futuristic Loader */
        .loader {
            width: 150px;
            height: 150px;
            position: relative;
        }
        .loader::before, .loader::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            inset: 0;
            box-shadow: 0 0 10px 2px rgba(0, 217, 255, 0.7), 0 0 10px 2px rgba(0, 217, 255, 0.7) inset;
        }
        .loader::after {
            box-shadow: 0 0 4px 1px #d000ff, 0 0 4px 1px #d000ff inset;
            animation: rotate 2s linear infinite;
        }
        @keyframes rotate {
            0% { transform: rotate(0); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ensure canvas is sharp for pixel art style upscale */
        canvas {
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* --- Gaya untuk Collapsible/Minimize --- */
        .collapsible-content {
            transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out;
            overflow: hidden;
        }
        
        .toggle-icon {
            transition: transform 0.3s ease-in-out;
        }
        
        /* --- Gaya untuk App Pose (Tambahan) --- */
        /* Menggunakan .loader-pose agar tidak konflik dengan .loader futuristic */
        .loader-pose {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f97316; /* Warna Oranye */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        .mini-loader {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none; /* Sembunyi default */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* === BARU: Gaya dari Aplikasi Remix Prompt === */
        
        .glass-panel {
            background-color: rgba(20, 10, 5, 0.7); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 127, 80, 0.15); 
        }
        
        .neon-orange-border {
            box-shadow: 0 0 10px #FF7F50, 0 0 5px #FF7F50 inset; 
            border-color: #FF7F50 !important;
        }
        
        .neon-cyan-text { 
            color: #00FFFF;
            text-shadow: 0 0 5px #00FFFF, 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .neon-orange-glow {
            box-shadow: 0 0 8px rgba(255, 127, 80, 0.8);
            transition: all 0.2s ease-in-out;
        }

        .neon-orange-glow:hover {
            box-shadow: 0 0 15px rgba(255, 127, 80, 1), 0 0 25px rgba(255, 127, 80, 0.5);
        }
        
        /* DIPERBARUI */
        .neon-cyan-glow {
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.8);
            transition: all 0.2s ease-in-out;
        }
        .neon-cyan-glow:hover {
            box-shadow: 0 0 15px rgba(0, 255, 255, 1), 0 0 25px rgba(0, 255, 255, 0.5);
        }


        @keyframes pulse-neon {
            0%, 100% { box-shadow: 0 0 5px #00FFFF; }
            50% { box-shadow: 0 0 20px #00FFFF; }
        }
        
        @keyframes pulse-orange-neon {
            0%, 100% { box-shadow: 0 0 5px #FF7F50; }
            50% { box-shadow: 0 0 20px #FF7F50; }
        }

        .loading-animation {
            animation: pulse-neon 1s infinite alternate;
        }
        
        .loading-animation-orange {
            animation: pulse-orange-neon 1s infinite alternate;
        }

        /* GAYA BARU SPESIFIK UNTUK APP INI */
        .themed-textarea {
            background-color: rgba(17, 24, 39, 0.5); /* bg-gray-900/50 */
            border: 1px solid rgba(255, 127, 80, 0.5); /* border-[#FF7F50]/50 */
            color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            padding: 0.75rem;
            width: 100%;
            min-height: 250px; /* Menyesuaikan tinggi */
            transition: all 0.2s ease;
        }
        .themed-textarea:focus {
            box-shadow: 0 0 0 2px #00FFFF, 0 0 8px #00FFFF; /* Sinar cyan */
            border-color: #00FFFF;
            outline: none;
        }
        .themed-textarea::placeholder {
            color: #6B7280; /* placeholder-gray-500 */
        }
        .themed-textarea:read-only {
            background-color: rgba(10, 5, 2, 0.6); /* Lebih gelap */
            color: #9CA3AF; /* text-gray-400 */
            cursor: not-allowed;
            border-color: rgba(255, 127, 80, 0.2);
        }
        
        /* GAYA BARU UNTUK INPUT FILE */
        .file-input-label {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            padding: 1.5rem;
            border: 2px dashed rgba(255, 127, 80, 0.5); /* border-[#FF7F50]/50 */
            background-color: rgba(17, 24, 39, 0.5); /* bg-gray-900/50 */
            border-radius: 0.75rem; /* rounded-xl */
            min-height: 190px; /* DIPERBARUI: Sedikit lebih tinggi untuk 2 tombol */
            transition: all 0.2s ease;
        }
        .file-input-label:hover, .file-input-label.dragover {
            background-color: rgba(17, 24, 39, 0.8);
            border-color: rgba(255, 127, 80, 0.8);
        }
        .file-input-label img {
            max-width: 100%;
            max-height: 150px; /* DIPERBARUI: Sedikit lebih tinggi */
            object-fit: contain;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
        }
        /* === AKHIR Gaya dari Aplikasi Remix Prompt === */
    </style>
</head>
<body class="text-gray-100">

    <!-- Kontainer Utama diperlebar ke max-w-4xl -->
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold font-orbitron neon-text-orange text-white">
                AI Labs Pro Suite v3
            </h1>
            <p class="text-gray-400 mt-2 text-lg">Buat Prompt Avatar -> Sempurnakan Sinematik -> Ciptakan Gambar AI.</p>
        </header>

        <main class="space-y-8">
            <!-- === LANGKAH 1: GENERATOR PROMPT (AVATAR PRO) === -->
            <section id="step-1" class="glass-card rounded-xl p-6 md:p-8">
                <!-- Header yang Bisa Diklik -->
                <div id="toggle-step-1" class="flex justify-between items-start cursor-pointer">
                    <div>
                        <h2 class="text-3xl font-semibold neon-text-orange font-orbitron">
                            <span class="text-4xl">1.</span> Buat Prompt Avatar
                        </h2>
                        <p class="text-gray-400 -mt-0 ml-10">Mulai dengan mendeskripsikan subjek, pakaian, dan lokasi Anda.</p>
                    </div>
                    <!-- Ikon Toggle -->
                    <svg id="toggle-icon-1" class="w-8 h-8 text-white toggle-icon flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>

                <!-- Konten yang Bisa Diminimalkan -->
                <div id="content-step-1" class="collapsible-content mt-6">
                    <form id="prompt-form" class="space-y-6">
                        <!-- KATEGORI 1: Tipe Shot / Angle -->
                        <fieldset class="border border-gray-700 p-4 rounded-lg">
                            <legend class="px-2 text-lg font-semibold text-white">1. Tipe Shot / Angle</legend>
                            <div class="mt-2">
                                <label for="cat1_tipe_shot" class="block mb-2 text-sm font-medium text-gray-300">Tipe Shot</label>
                                <select id="cat1_tipe_shot" class="w-full p-2.5 rounded-lg neon-input text-white">
                                    <option value="">(Pilih Tipe Shot)</option>
                                    <option value="Medium close-up">Medium close-up (Contoh)</option>
                                    <option value="Over-the-shoulder shot">Over-the-shoulder shot (Contoh)</option>
                                    <option value="">--- Pilihan Umum ---</option>
                                    <option value="Full shot">Full shot</option>
                                    <option value="Medium shot">Medium shot</option>
                                    <option value="Cowboy shot">Cowboy shot (Pinggang ke atas)</option>
                                    <option value="Close-up">Close-up</option>
                                    <option value="Extreme close-up">Extreme close-up (Mata)</option>
                                    <option value="Eye-level shot">Eye-level shot</option>
                                    <option value="Low-angle shot">Low-angle shot</option>
                                    <option value="Worm's-eye view">Worm's-eye view (Dari bawah)</option>
                                    <option value="Extreme worm's-eye view">Extreme worm's-eye view</option>
                                    <option value="High-angle shot">High-angle shot</option>
                                    <option value="Bird's-eye view (Drone shot)">Bird's-eye view (Drone shot)</option>
                                    <option value="Extreme bird's-eye view">Extreme bird's-eye view</option>
                                    <option value="Dutch angle">Dutch angle (Miring)</option>
                                    <option value="POV (Point of View)">POV (Point of View)</option>
                                    <option value="lainnya">Lainnya...</option>
                                </select>
                                <input type="text" id="cat1_tipe_shot_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Tipe shot kustom...">
                            </div>
                        </fieldset>

                        <!-- KATEGORI 2: Kamera & Teknis -->
                        <fieldset class="border border-gray-700 p-4 rounded-lg">
                            <legend class="px-2 text-lg font-semibold text-white">2. Kamera & Teknis</legend>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                <div>
                                    <label for="cat2_kamera" class="block mb-2 text-sm font-medium text-gray-300">Kamera / Lensa</label>
                                    <select id="cat2_kamera" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Kamera)</option>
                                        <option value="Kamera studio profesional, Lensa prime">Kamera studio profesional, Lensa prime (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="DSLR, 50mm lens">DSLR, 50mm lens</option>
                                        <option value="Cinema camera, 85mm lens">Cinema camera, 85mm lens</option>
                                        <option value="Sony A7R V, 85mm lens">Sony A7R V, 85mm lens</option>
                                        <option value="Canon EOS R5, 50mm lens">Canon EOS R5, 50mm lens</option>
                                        <option value="Lensa Telephoto (zoom)">Lensa Telephoto (zoom)</option>
                                        <option value="Lensa wide-angle">Lensa wide-angle</option>
                                        <option value="Lensa Macro (detail)">Lensa Macro (detail)</option>
                                        <option value="Smartphone camera (iPhone 15 Pro)">Smartphone camera (iPhone 15 Pro)</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat2_kamera_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Kamera kustom...">
                                </div>
                                <div>
                                    <label for="cat2_teknis" class="block mb-2 text-sm font-medium text-gray-300">Detail Teknis</label>
                                    <select id="cat2_teknis" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Detail Teknis)</option>
                                        <option value="Shallow depth of field, High contrast">Shallow depth of field, High contrast (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="Shallow depth of field (bokeh)">Shallow depth of field (bokeh)</option>
                                        <option value="Deep depth of field">Deep depth of field</option>
                                        <option value="Motion blur">Motion blur</option>
                                        <option value="Long exposure">Long exposure</option>
                                        <option value="Lens flare">Lens flare</option>
                                        <option value="Vibrant colors">Vibrant colors</option>
                                        <option value="Monochrome (Hitam Putih)">Monochrome (Hitam Putih)</option>
                                        <option value="Low contrast (Soft)">Low contrast (Soft)</option>
                                        <option value="High contrast (Dramatis)">High contrast (Dramatis)</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat2_teknis_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Teknis kustom...">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="cat2_kualitas" class="block mb-2 text-sm font-medium text-gray-300">Kualitas & Tekstur</label>
                                    <select id="cat2_kualitas" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Kualitas)</option>
                                        <option value="8K resolution, Hyperrealistic, Ultra detailed skin texture">8K, Hyperrealistic, Ultra detailed skin (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="Ultra realistic, 8k, sharp focus">Ultra realistic, 8k, sharp focus</option>
                                        <option value="Photorealistic">Photorealistic</option>
                                        <option value="Highly detailed">Highly detailed</option>
                                        <option value="Detailed skin texture">Detailed skin texture</option>
                                        <option value="Detailed fabric texture">Detailed fabric texture</option>
                                        <option value="Film grain">Film grain</option>
                                        <option value="Soft focus (dreamy)">Soft focus (dreamy)</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat2_kualitas_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Kualitas kustom...">
                                </div>
                            </div>
                        </fieldset>

                        <!-- KATEGORI 3: Subjek (Karakter) -->
                        <fieldset class="border border-gray-700 p-4 rounded-lg">
                            <legend class="px-2 text-lg font-semibold text-white">3. Subjek (Karakter)</legend>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                <div>
                                    <label for="cat3_gender_etnis" class="block mb-2 text-sm font-medium text-gray-300">Gender & Etnis</label>
                                    <select id="cat3_gender_etnis" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Subjek)</option>
                                        <option value="Wanita muda Asia">Wanita muda Asia (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="Wanita muda Indonesia">Wanita muda Indonesia</option>
                                        <option value="Wanita muda Indonesia (berhijab)">Wanita muda Indonesia (berhijab)</option>
                                        <option value="Pria muda Indonesia">Pria muda Indonesia</option>
                                        <option value="Wanita Kaukasia">Wanita Kaukasia</option>
                                        <option value="Pria Kaukasia">Pria Kaukasia</option>
                                        <option value="Wanita Asia Timur (Jepang/Korea)">Wanita Asia Timur (Jepang/Korea)</option>
                                        <option value="Pria Asia Timur (Jepang/Korea)">Pria Asia Timur (Jepang/Korea)</option>
                                        <option value="Wanita Latin">Wanita Latin</option>
                                        <option value="Pria Afrika">Pria Afrika</option>
                                        <option value="Pria paruh baya">Pria paruh baya</option>
                                        <option value="Wanita lanjut usia">Wanita lanjut usia</option>
                                        <option value="Anak-anak">Anak-anak</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat3_gender_etnis_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Subjek kustom...">
                                </div>
                                <div>
                                    <label for="cat3_bentuk_tubuh" class="block mb-2 text-sm font-medium text-gray-300">Bentuk Tubuh</label>
                                    <select id="cat3_bentuk_tubuh" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Bentuk Tubuh)</option>
                                        <option value="Sedikit gemuk, Big breast">Sedikit gemuk, Big breast (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="Atletis">Atletis</option>
                                        <option value="Ototan (Muscular)">Ototan (Muscular)</option>
                                        <option value="Ramping (Slim)">Ramping (Slim)</option>
                                        <option value="Berisi (Curvy)">Berisi (Curvy)</option>
                                        <option value="Sangat kurus (Skinny)">Sangat kurus (Skinny)</option>
                                        <option value="Bentuk tubuh rata-rata">Bentuk tubuh rata-rata</option>
                                        <option value="Tinggi">Tinggi</option>
                                        <option value="Pendek">Pendek</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat3_bentuk_tubuh_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Bentuk tubuh kustom...">
                                </div>
                                <div>
                                    <label for="cat3_rambut" class="block mb-2 text-sm font-medium text-gray-300">Rambut</label>
                                    <select id="cat3_rambut" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Gaya Rambut)</option>
                                        <option value="Cepol ganda (space buns), Helai rambut menjuntai">Cepol ganda (space buns), Helai menjuntai (Contoh)</option>
                                        <option value="">--- Pilihan Gaya ---</option>
                                        <option value="Rambut pendek rapi">Rambut pendek rapi</option>
                                        <option value="Rambut panjang terurai">Rambut panjang terurai</option>
                                        <option value="Rambut ikal (Curly hair)">Rambut ikal (Curly hair)</option>
                                        <option value="Rambut keriting (Afro hair)">Rambut keriting (Afro hair)</option>
                                        <option value="Kuncir kuda (Ponytail)">Kuncir kuda (Ponytail)</option>
                                        <option value="Gaya Man Bun">Gaya Man Bun</option>
                                        <option value="Cepak (Buzz cut)">Cepak (Buzz cut)</option>
                                        <option value="Botak (Bald)">Botak (Bald)</option>
                                        <optgroup label="--- Warna Rambut ---">
                                            <option value="Rambut warna Hitam">Rambut warna Hitam</option>
                                            <option value="Rambut warna Cokelat">Rambut warna Cokelat</option>
                                            <option value="Rambut warna Pirang (Blonde)">Rambut warna Pirang (Blonde)</option>
                                            <option value="Rambut warna Merah">Rambut warna Merah</option>
                                            <option value="Rambut warna Abu-abu / Putih">Rambut warna Abu-abu / Putih</option>
                                            <option value="Rambut warna Biru">Rambut warna Biru</option>
                                            <option value="Rambut warna Pink">Rambut warna Pink</option>
                                            <option value="Rambut warna Hijau">Rambut warna Hijau</option>
                                            <option value="Rambut warna Ungu">Rambut warna Ungu</option>
                                        </optgroup>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat3_rambut_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Rambut kustom...">
                                </div>
                                <div>
                                    <label for="cat3_wajah" class="block mb-2 text-sm font-medium text-gray-300">Wajah & Ekspresi</label>
                                    <select id="cat3_wajah" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Wajah/Ekspresi)</option>
                                        <option value="Tatapan tajam, Ekspresi provokatif">Tatapan tajam, Ekspresi provokatif (Contoh)</option>
                                        <option value="Menggunakan foto referensi (detail wajah asli dipertahankan)">Gunakan foto referensi (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="Tersenyum ramah">Tersenyum ramah</option>
                                        <option value="Tertawa lepas">Tertawa lepas</option>
                                        <option value="Ekspresi serius">Ekspresi serius</option>
                                        <option value="Ekspresi sedih">Ekspresi sedih</option>
                                        <option value="Ekspresi marah">Ekspresi marah</option>
                                        <option value="Ekspresi terkejut">Ekspresi terkejut</option>
                                        <option value="Mata tertutup (tenang)">Mata tertutup (tenang)</option>
                                        <option value="Mata berbinar">Mata berbinar</option>
                                        <option value="Ekspresi genit">Ekspresi genit (Flirty)</option>
                                        <option value="Satu mata tertutup (Winking)">Satu mata tertutup (Winking)</option>
                                        <option value="Menjulurkan lidah">Menjulurkan lidah</option>
                                        <option value="Cemberut (Pouting)">Cemberut (Pouting)</option>
                                        <option value="Meniup ciuman (Blowing a kiss)">Meniup ciuman (Blowing a kiss)</option>
                                        <option value="Mata melihat ke atas (Rolling eyes)">Mata melihat ke atas (Rolling eyes)</option>
                                        <option value="Ekspresi bingung">Ekspresi bingung</option>
                                        <option value="Menangis">Menangis</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat3_wajah_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Wajah/ekspresi kustom...">
                                </div>
                            </div>
                        </fieldset>

                        <!-- KATEGORI 4: Pose & Arah Tubuh -->
                        <fieldset class="border border-gray-700 p-4 rounded-lg">
                            <legend class="px-2 text-lg font-semibold text-white">4. Pose & Arah Tubuh</legend>
                            <div class="mt-2">
                                <label for="cat4_pose" class="block mb-2 text-sm font-medium text-gray-300">Pose</label>
                                <select id="cat4_pose" class="w-full p-2.5 rounded-lg neon-input text-white">
                                    <option value="">(Pilih Pose)</option>
                                    <option value="Berbalik menghadap kamera, Over-the-shoulder angle, Bahu kiri terbuka">Berbalik menghadap kamera, over-the-shoulder (Contoh)</option>
                                    <option value="">--- Pilihan Umum ---</option>
                                    <option value="Berdiri tegak menghadap depan">Berdiri tegak menghadap depan</option>
                                    <option value="Berdiri, tangan di saku">Berdiri, tangan di saku</option>
                                    <option value="Berdiri, melihat ke samping">Berdiri, melihat ke samping</option>
                                    <option value="Berjalan ke arah kamera">Berjalan ke arah kamera</option>
                                    <option value="Bersandar ke dinding">Bersandar ke dinding</option>
                                    <option value="Menari">Menari</option>
                                    <optgroup label="--- Pose Aksi & Dinamis ---">
                                        <option value="Berlari">Berlari</option>
                                        <option value="Lompat di udara (pose dinamis)">Lompat di udara (pose dinamis)</option>
                                        <option value="Pose bertarung (Fighting stance)">Pose bertarung (Fighting stance)</option>
                                        <option value="Berlutut satu kaki (Kneeling)">Berlutut satu kaki (Kneeling)</option>
                                        <option value="Pose yoga">Pose yoga</option>
                                    </optgroup>
                                    <optgroup label="--- Pose Duduk & Santai ---">
                                        <option value="Duduk santai di sofa">Duduk santai di sofa</option>
                                        <option value="Duduk di kursi, menatap tajam">Duduk di kursi, menatap tajam</option>
                                        <option value="Duduk di lantai">Duduk di lantai</option>
                                        <option value="Duduk bersila di lantai">Duduk bersila di lantai</option>
                                        <option value="Berjongkok (Squatting)">Berjongkok (Squatting)</option>
                                        <option value="Berbaring">Berbaring</option>
                                        <option value="Berbaring santai di rumput">Berbaring santai di rumput</option>
                                    </optgroup>
                                    <optgroup label="--- Pose Model & Fashion ---">
                                        <option value="Tangan di pinggul (Hands on hips)">Tangan di pinggul (Hands on hips)</option>
                                        <option value="Berjalan (Catwalk pose)">Berjalan (Catwalk pose)</option>
                                        <option value="Satu tangan menyentuh wajah/rambut">Satu tangan menyentuh wajah/rambut</option>
                                        <option value="Menyilangkan tangan di dada">Menyilangkan tangan di dada</option>
                                        <option value="Melihat ke belakang (Looking back)">Melihat ke belakang</option>
                                        <option value="Kedua tangan membentuk hati">Kedua tangan membentuk hati</option>
                                        <option value="Tangan membentuk tanda 'peace'">Tangan membentuk tanda 'peace'</option>
                                        <option value="Tangan membentuk 'saranghaeyo' (Korean heart)">Tangan membentuk 'saranghaeyo' (Korean heart)</option>
                                    </optgroup>
                                    <option value="lainnya">Lainnya...</option>
                                </select>
                                <input type="text" id="cat4_pose_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Pose kustom...">
                            </div>
                        </fieldset>

                        <!-- KATEGORI 5: Aksesoris & Riasan -->
                        <fieldset class="border border-gray-700 p-4 rounded-lg">
                            <legend class="px-2 text-lg font-semibold text-white">5. Pakaian, Aksesoris & Riasan</legend>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                                <div>
                                    <label for="cat5_baju" class="block mb-2 text-sm font-medium text-gray-300">Baju (Atasan)</label>
                                    <select id="cat5_baju" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Atasan)</option>
                                        <option value="Atasan tali spageti hitam">Spageti top (Contoh)</option>
                                        <optgroup label="--- Kaos & Kasual ---">
                                            <option value="Kaos polos (Putih)">Kaos polos (Putih)</option>
                                            <option value="Kaos polos (Hitam)">Kaos polos (Hitam)</option>
                                            <option value="Kaos polos (Merah)">Kaos polos (Merah)</option>
                                            <option value="Kaos polos (Biru)">Kaos polos (Biru)</option>
                                            <option value="Kaos polos (Abu-abu)">Kaos polos (Abu-abu)</option>
                                            <option value="Oversized t-shirt (Hitam)">Oversized t-shirt (Hitam)</option>
                                            <option value="Graphic tee (Streetwear)">Graphic tee (Streetwear)</option>
                                        </optgroup>
                                        <optgroup label="--- Hoodie & Jaket ---">
                                            <option value="Hoodie (Hitam)">Hoodie (Hitam)</option>
                                            <option value="Hoodie (Abu-abu)">Hoodie (Abu-abu)</option>
                                            <option value="Hoodie (Biru Navy)">Hoodie (Biru Navy)</option>
                                            <option value="Oversized hoodie (Krem)">Oversized hoodie (Krem)</option>
                                            <option value="Jaket denim (Biru)">Jaket denim (Biru)</option>
                                            <option value="Jaket denim oversized (melorot di bahu)">Jaket denim oversized (melorot di bahu)</option>
                                            <option value="Jaket kulit (Hitam)">Jaket kulit (Hitam)</option>
                                            <option value="Jaket bomber (Hijau army)">Jaket bomber (Hijau army)</option>
                                        </optgroup>
                                        <optgroup label="--- Rajut (Knitwear) ---">
                                            <option value="Cardigan rajut (Krem)">Cardigan rajut (Krem)</option>
                                            <option value="Sweater rajut (Maroon)">Sweater rajut (Maroon)</option>
                                            <option value="Crop top rajut (Putih)">Crop top rajut (Putih)</option>
                                        </optgroup>
                                        <optgroup label="--- Kemeja & Formal ---">
                                            <option value="Kemeja formal (Putih)">Kemeja formal (Putih)</option>
                                            <option value="Kemeja flanel (Kotak-kotak)">Kemeja flanel (Kotak-kotak)</option>
                                            <option value="Blouse sutra (Wanita)">Blouse sutra (Wanita)</option>
                                            <option value="Blazer (Hitam)">Blazer (Hitam)</option>
                                            <option value="Setelan jas (Hitam)">Setelan jas (Hitam)</option>
                                        </optgroup>
                                        <optgroup label="--- Gamis, Gaun & Tradisional ---">
                                            <option value="Gamis (Hitam, elegan)">Gamis (Hitam, elegan)</option>
                                            <option value="Gamis (Putih, sederhana)">Gamis (Putih, sederhana)</option>
                                            <option value="Kaftan (Modern, motif)">Kaftan (Modern, motif)</option>
                                            <option value="Pakaian dengan Hijab (modest fashion)">Pakaian dengan Hijab (modest fashion)</option>
                                            <option value="Gaun malam elegan (Merah)">Gaun malam elegan (Merah)</option>
                                            <option value="Pakaian tradisional (Batik)">Pakaian tradisional (Batik)</option>
                                        </optgroup>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat5_baju_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Baju kustom...">
                                </div>
                                <div>
                                    <label for="cat5_celana" class="block mb-2 text-sm font-medium text-gray-300">Celana (Bawahan)</label>
                                    <select id="cat5_celana" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Bawahan)</option>
                                        <optgroup label="--- Jeans ---">
                                            <option value="Celana jeans (Biru)">Celana jeans (Biru)</option>
                                            <option value="Celana jeans (Hitam)">Celana jeans (Hitam)</option>
                                            <option value="Celana jeans (Biru muda)">Celana jeans (Biru muda)</option>
                                            <option value="Celana jeans robek (Biru)">Celana jeans robek (Biru)</option>
                                            <option value="Celana jeans model wide-leg">Celana jeans model wide-leg</option>
                                        </optgroup>
                                        <optgroup label="--- Celana Kain & Trending ---">
                                            <option value="Celana kain (Hitam)">Celana kain (Hitam)</option>
                                            <option value="Celana Chino (Khaki)">Celana Chino (Khaki)</option>
                                            <option value="Celana kargo (Cargo pants, Krem)">Celana kargo (Cargo pants, Krem)</option>
                                            <option value="Celana wide-leg (Kain, Hitam)">Celana wide-leg (Kain, Hitam)</option>
                                        </optgroup>
                                        <optgroup label="--- Santai & Olahraga ---">
                                            <option value="Celana jogger (Abu-abu)">Celana jogger (Abu-abu)</option>
                                            <option value="Sweatpants (Hitam)">Sweatpants (Hitam)</option>
                                            <option value="Celana pendek (Hitam)">Celana pendek (Hitam)</option>
                                            <option value="Legging (Hitam)">Legging (Hitam)</option>
                                        </optgroup>
                                        <optgroup label="--- Rok (Skirts) ---">
                                            <option value="Rok (Hitam)">Rok (Hitam)</option>
                                            <option value="Rok (Putih)">Rok (Putih)</option>
                                            <option value="Rok plisket (Pleated, Pink pastel)">Rok plisket (Pleated, Pink pastel)</option>
                                            <option value="Rok denim (Biru)">Rok denim (Biru)</option>
                                        </optgroup>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat5_celana_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Celana kustom...">
                                </div>
                                <div>
                                    <label for="cat5_aksesoris" class="block mb-2 text-sm font-medium text-gray-300">Aksesoris</label>
                                    <select id="cat5_aksesoris" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Aksesoris)</option>
                                        <option value="Anting rumbai panjang putih-perak, Bordir 'dc' & siluet panda di jaket">Anting rumbai & bordir (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="Kacamata hitam">Kacamata hitam</option>
                                        <option value="Kacamata (minus/baca)">Kacamata (minus/baca)</option>
                                        <option value="Topi baseball">Topi baseball</option>
                                        <option value="Beanie (Kupluk)">Beanie (Kupluk)</option>
                                        <option value="Headphone (menggantung di leher)">Headphone (menggantung di leher)</option>
                                        <option value="Jam tangan (Rolex style)">Jam tangan (Rolex style)</option>
                                        <option value="Jam tangan (G-Shock style)">Jam tangan (G-Shock style)</option>
                                        <option value="Kalung emas tipis">Kalung emas tipis</option>
                                        <option value="Kalung rantai (Cuban link)">Kalung rantai (Cuban link)</option>
                                        <option value="Tas ransel (Backpack)">Tas ransel (Backpack)</option>
                                        <option value="Tas selempang (Sling bag)">Tas selempang (Sling bag)</option>
                                        <option value="Syal">Syal</option>
                                        <option value="">Tidak ada aksesoris</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat5_aksesoris_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Aksesoris kustom...">
                                </div>
                                <div>
                                    <label for="cat5_riasan" class="block mb-2 text-sm font-medium text-gray-300">Riasan (Makeup)</label>
                                    <select id="cat5_riasan" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Riasan)</option>
                                        <option value="Riasan mata dramatis">Riasan mata dramatis (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="Riasan natural (natural makeup)">Riasan natural</option>
                                        <option value="Riasan 'No Makeup' makeup">Riasan 'No Makeup' makeup</option>
                                        <option value="Smokey eyes">Smokey eyes</option>
                                        <option value="Eyeliner winged (Cat eye)">Eyeliner winged (Cat eye)</option>
                                        <option value="Glitter eyeshadow">Glitter eyeshadow</option>
                                        <option value="Lipstik merah cerah">Lipstik merah cerah</option>
                                        <option value="Lipstik nude">Lipstik nude</option>
                                        <option value="Lipstik glossy">Lipstik glossy</option>
                                        <option value="Blush on (pipi merona)">Blush on (pipi merona)</option>
                                        <option value="Contouring tajam">Contouring tajam</option>
                                        <option value="Freckles (bintik-bintik) palsu">Freckles (bintik-bintik) palsu</option>
                                        <option value="Gothic makeup">Gothic makeup</option>
                                        <option value="E-girl makeup (eyeliner tebal)">E-girl makeup</option>
                                        <option value="Riasan 'Douyin' (Korean style)">Riasan 'Douyin' (Korean style)</option>
                                        <option value="Riasan pengantin">Riasan pengantin</option>
                                        <option value="">Tanpa riasan</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat5_riasan_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Riasan kustom...">
                                </div>
                                <div>
                                    <label for="cat5_tato" class="block mb-2 text-sm font-medium text-gray-300">Tato (Opsional)</label>
                                    <select id="cat5_tato" class="w-full p-2.5 rounded-lg neon-input text-white">
                                        <option value="">(Pilih Tato)</option>
                                        <option value="Tato naga di bahu kiri">Tato naga di bahu kiri (Contoh)</option>
                                        <option value="">--- Pilihan Umum ---</option>
                                        <option value="Tato tribal di lengan">Tato tribal di lengan</option>
                                        <option value="Sleeve tattoo (lengan penuh)">Sleeve tattoo (lengan penuh)</option>
                                        <option value="Tato bunga kecil di pergelangan tangan">Tato bunga kecil di pergelangan tangan</option>
                                        <option value="Tato di leher">Tato di leher</option>
                                        <option value="Tato kecil di wajah">Tato kecil di wajah</option>
                                        <option value="">Tidak ada tato</option>
                                        <option value="lainnya">Lainnya...</option>
                                    </select>
                                    <input type="text" id="cat5_tato_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Tato kustom...">
                                </div>
                            </div>
                        </fieldset>

                        <!-- KATEGORI 6: Pencahayaan -->
                        <fieldset class="border border-gray-700 p-4 rounded-lg">
                            <legend class="px-2 text-lg font-semibold text-white">6. Pencahayaan</legend>
                            <div class="mt-2">
                                <label for="cat6_pencahayaan" class="block mb-2 text-sm font-medium text-gray-300">Gaya Pencahayaan</label>
                                <select id="cat6_pencahayaan" class="w-full p-2.5 rounded-lg neon-input text-white">
                                    <option value="">(Pilih Pencahayaan)</option>
                                    <option value="Studio lighting dramatis, Rim light kuat warna neon ungu kebiruan, Backlighting">Studio dramatis, Rim light neon ungu (Contoh)</option>
                                    <option value="">--- Pilihan Umum ---</option>
                                    <option value="Cahaya matahari alami (Natural sunlight)">Cahaya matahari alami</option>
                                    <option value="Golden hour (Senja)">Golden hour (Senja)</option>
                                    <option value="Blue hour (Setelah senja)">Blue hour (Setelah senja)</option>
                                    <option value="Cahaya neon kota di malam hari">Cahaya neon kota (Malam)</option>
                                    <option value="Studio (Softbox lighting)">Studio (Softbox lighting)</option>
                                    <option value="Studio (Rembrandt lighting)">Studio (Rembrandt lighting)</option>
                                    <option value="Hard flash (Direct flash photography)">Hard flash (Direct flash photography)</option>
                                    <option value="Siluet (Backlit sangat kuat)">Siluet (Backlit sangat kuat)</option>
                                    <option value="Cahaya bulan (Moonlight)">Cahaya bulan (Moonlight)</option>
                                    <option value="Cahaya api unggun">Cahaya api unggun</option>
                                    <option value="lainnya">Lainnya...</option>
                                </select>
                                <input type="text" id="cat6_pencahayaan_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Pencahayaan kustom...">
                            </div>
                        </fieldset>

                        <!-- KATEGORI 7: Latar Belakang -->
                        <fieldset class="border border-gray-700 p-4 rounded-lg">
                            <legend class="px-2 text-lg font-semibold text-white">7. Latar Belakang</legend>
                            <div class="mt-2">
                                <label for="cat7_latar" class="block mb-2 text-sm font-medium text-gray-300">Lokasi / Latar</label>
                                <select id="cat7_latar" class="w-full p-2.5 rounded-lg neon-input text-white">
                                    <option value="">(Pilih Latar)</option>
                                    <option value="Studio polos warna hitam gelap pekat">Studio polos hitam pekat (Contoh)</option>
                                    <optgroup label="--- Studio ---">
                                        <option value="Studio polos (Hitam)">Studio polos (Hitam)</option>
                                        <option value="Studio polos (Putih)">Studio polos (Putih)</option>
                                        <option value="Studio polos (Abu-abu)">Studio polos (Abu-abu)</option>
                                        <option value="Studio polos (Warna cerah, misal: Pink)">Studio polos (Warna cerah)</option>
                                        <option value="Latar belakang Muslin (bertekstur)">Latar belakang Muslin (bertekstur)</option>
                                    </optgroup>
                                    <optgroup label="--- Urban / Kota ---">
                                        <option value="Jalanan kota yang ramai (Siang)">Jalanan kota yang ramai (Siang)</option>
                                        <option value="Jalanan Tokyo (malam, neon)">Jalanan Tokyo (malam, neon)</option>
                                        <option value="Atap gedung (Rooftop) saat senja">Atap gedung (Rooftop) saat senja</option>
                                        <option value="Jalanan sempit (gang) bergaya industrial">Jalanan sempit (gang) industrial</option>
                                        <option value="Jembatan kota di malam hari">Jembatan kota di malam hari</option>
                                        <option value="Tembok grafiti">Tembok grafiti</option>
                                        <option value="Stasiun kereta api tua">Stasiun kereta api tua</option>
                                        <option value="Pasar malam (Night market)">Pasar malam (Night market)</option>
                                        <option value="Bangunan arsitektur modern">Bangunan arsitektur modern</option>
                                    </optgroup>
                                    <optgroup label="--- Interior / Dalam Ruangan ---">
                                        <option value="Kafe yang nyaman (Interior)">Kafe yang nyaman (Interior)</option>
                                        <option value="Perpustakaan">Perpustakaan</option>
                                        <option value="Kamar tidur modern (Apartemen mewah)">Kamar tidur modern (Apartemen mewah)</option>
                                        <option value="Lobi hotel mewah">Lobi hotel mewah</option>
                                        <option value="Museum seni">Museum seni</option>
                                        <option value="Bar/klub malam yang remang-remang">Bar/klub malam yang remang-remang</option>
                                        <option value="Restoran fine dining">Restoran fine dining</option>
                                        <option value="Gym / Pusat kebugaran">Gym / Pusat kebugaran</option>
                                        <option value="Ruang tamu bergaya Skandinavia">Ruang tamu bergaya Skandinavia</option>
                                        <option value="Dapur modern">Dapur modern</option>
                                    </optgroup>
                                    <optgroup label="--- Alam (Outdoor) ---">
                                        <option value="Pantai saat matahari terbenam">Pantai saat matahari terbenam</option>
                                        <option value="Hutan berkabut">Hutan berkabut</option>
                                        <option value="Pegunungan (Pemandangan luas)">Pegunungan (Pemandangan luas)</option>
                                        <option value="Air terjun">Air terjun</option>
                                        <option value="Danau yang tenang (memantul)">Danau yang tenang (memantul)</option>
                                        <option value="Padang rumput bunga liar">Padang rumput bunga liar</option>
                                        <option value="Gurun pasir saat senja">Gurun pasir saat senja</option>
                                        <option value="Di bawah air (Underwater)">Di bawah air (Underwater)</option>
                                        <option value="Ladang gandum emas">Ladang gandum emas</option>
                                        <option value="Jalan setapak di hutan musim gugur">Jalan setapak hutan musim gugur</option>
                                        <option value="Salju (Pemandangan musim dingin)">Salju (Pemandangan musim dingin)</option>
                                        <option value="Kebun raya (Botanical garden)">Kebun raya (Botanical garden)</option>
                                    </optgroup>
                                    <optgroup label="--- Fantasi & Fiksi Ilmiah ---">
                                        <option value="Latar belakang Cyberpunk (Kota neon)">Latar belakang Cyberpunk</option>
                                        <option value="Latar belakang Steampunk (Roda gigi, uap)">Latar belakang Steampunk</option>
                                        <option value="Interior pesawat luar angkasa">Interior pesawat luar angkasa</option>
                                        <option value="Istana fantasi (Kastil)">Istana fantasi (Kastil)</option>
                                        <option value="Reruntuhan kuno">Reruntuhan kuno</option>
                                        <option value="Hutan ajaib (bercahaya)">Hutan ajaib (bercahaya)</option>
                                        <option value="Latar belakang abstrak (geometris)">Latar belakang abstrak (geometris)</option>
                                        <option value="Latar belakang luar angkasa (Nebula)">Latar belakang luar angkasa (Nebula)</option>
                                        <option value="Kerajaan di atas awan">Kerajaan di atas awan</option>
                                    </optgroup>
                                    <option value="lainnya">Lainnya...</option>
                                </select>
                                <input type="text" id="cat7_latar_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Latar kustom...">
                            </div>
                        </fieldset>

                        <!-- KATEGORI 8: Style / Genre -->
                        <fieldset class="border border-gray-700 p-4 rounded-lg">
                            <legend class="px-2 text-lg font-semibold text-white">8. Style / Genre</legend>
                            <div class="mt-2">
                                <label for="cat8_style" class="block mb-2 text-sm font-medium text-gray-300">Gaya Visual</label>
                                <select id="cat8_style" class="w-full p-2.5 rounded-lg neon-input text-white">
                                    <option value="">(Pilih Gaya)</option>
                                    <option value="Fashion photography, Editorial look, Studio portrait, Hyperrealistic, Ultra detailed, 8K resolution">Fashion, Editorial, Hyperrealistic (Contoh)</option>
                                    <option value="">--- Pilihan Umum ---</option>
                                    <option value="Sinematik">Sinematik</option>
                                    <option value="Fotografi fashion">Fotografi fashion</option>
                                    <option value="Fotografi hitam putih">Fotografi hitam putih</option>
                                    <option value="Fantasi">Fantasi</option>
                                    <option value="Cyberpunk">Cyberpunk</option>
                                    <option value="Steampunk">Steampunk</option>
                                    <option value="Vaporwave">Vaporwave</option>
                                    <option value="Gothic">Gothic</option>
                                    <option value="Lukisan cat minyak">Lukisan cat minyak</option>
                                    <option value="Lukisan cat air">Lukisan cat air</option>
                                    <option value="Anime / Manga">Anime / Manga</option>
                                    <option value="Pixel Art">Pixel Art</option>
                                    <option value="lainnya">Lainnya...</option>
                                </select>
                                <input type="text" id="cat8_style_kustom" class="mt-2 w-full p-2.5 rounded-lg neon-input text-white placeholder-gray-500 hidden" placeholder="Style kustom...">
                            </div>
                        </fieldset>
                        
                        <div class="mt-6">
                            <h3 class="text-xl font-semibold text-white mb-2">Prompt Deskriptif Anda:</h3>
                            <div class="relative">
                                <!-- DIUBAH: rows="8" menjadi rows="10" -->
                                <textarea id="output-prompt-1" rows="10" class="w-full p-4 pr-12 rounded-lg neon-input text-gray-300" readonly></textarea>
                                <button id="copy-button-1" type="button" class="absolute top-3 right-3 text-gray-400 hover:text-white bg-gray-900/50 p-2 rounded-lg" title="Salin ke Clipboard">
                                    <!-- Ikon Salin -->
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                </button>
                            </div>
                        </div>
                    </form>
                </div> <!-- Akhir Konten Collapsible Langkah 1 -->
            </section>

            <!-- === KONEKTOR LANGKAH === -->
            <div class="step-connector">
                <button id="send-to-step-2" type="button" class="btn btn-neon-blue w-full md:w-auto">
                    Kirim ke Langkah 2 (Cinematik)
                    <svg class="w-5 h-5 inline-block ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                </button>
            </div>
            
            <!-- === LANGKAH 2: CINEMATIC PROMPT TRANSFORMER === -->
            <section id="step-2" class="glass-card rounded-xl p-6 md:p-8">
                <!-- Header yang Bisa Diklik -->
                <div id="toggle-step-2" class="flex justify-between items-start cursor-pointer">
                    <div>
                        <h2 class="text-3xl font-semibold mb-0 neon-text-blue font-orbitron">
                            <span class="text-4xl">2.</span> Sempurnakan Sinematik (AI)
                        </h2>
                        <p class="text-gray-400 -mt-0 ml-10">AI akan mengubah prompt Anda menjadi arahan adegan sinematik.</p>
                    </div>
                    <!-- Ikon Toggle -->
                    <svg id="toggle-icon-2" class="w-8 h-8 text-white toggle-icon flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
                
                <!-- Konten yang Bisa Diminimalkan -->
                <div id="content-step-2" class="collapsible-content mt-6">
                    <div class="space-y-4">
                        <div>
                            <label for="prompt-input-2" class="block text-sm font-medium text-gray-300 mb-2">Prompt Deskriptif (dari Langkah 1):</label>
                            <!-- DIUBAH: rows="7" menjadi rows="10" -->
                            <textarea id="prompt-input-2" rows="10" class="w-full p-3 rounded-lg neon-input text-white placeholder-gray-500" placeholder="Kirim prompt dari Langkah 1..."></textarea>
                        </div>
                        
                        <button id="generate-cinematic-button" class="w-full btn btn-neon-blue">
                            Transformasi jadi Sinematik
                        </button>
                    
                    <div id="loading-indicator-2" class="hidden text-center p-4">
                        <div class="spinner !border-t-[var(--neon-blue)] mx-auto" style="animation-name: spin, pulse-neon-blue;"></div>
                        <style>
                            @keyframes pulse-neon-blue {
                                0%, 100% { box-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue); }
                                50% { box-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue); }
                            }
                        </style>
                        <p class="mt-4 text-gray-300 neon-text-blue font-orbitron text-lg">MENGANALISIS ADEGAN...</p>
                    </div>

                    <!-- Hasil Langkah 2 -->
                    <div id="result-step-2" class="hidden space-y-4">
                        <div>
                            <label for="output-prompt-2" class="block text-sm font-medium text-gray-300 mb-2">Hasil Prompt Sinematik:</label>
                            <div class="relative">
                                <!-- DIUBAH: rows="12" menjadi rows="15" -->
                                <textarea id="output-prompt-2" rows="15" class="w-full p-4 pr-12 rounded-lg neon-input text-gray-300" readonly></textarea>
                                <button id="copy-button-2" type="button" class="absolute top-3 right-3 text-gray-400 hover:text-white bg-gray-900/50 p-2 rounded-lg" title="Salin ke Clipboard">
                                    <!-- Ikon Salin -->
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div> 
                </div> <!-- Akhir Konten Collapsible Langkah 2 -->
            </section>

             <!-- === KONEKTOR LANGKAH === -->
            <div class="step-connector">
                <button id="send-to-step-3" type="button" class="btn btn-neon-green w-full md:w-auto">
                    Kirim ke Langkah 3 (Ciptakan)
                    <svg class="w-5 h-5 inline-block ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                </button>
            </div>

            <!-- === LANGKAH 3: GENERATOR GAMBAR (AI LABS) === -->
            <div class="max-w-3xl mx-auto">
                <section id="step-3" class="glass-card rounded-xl p-6 md:p-8">
                    <!-- Header yang Bisa Diklik -->
                    <div id="toggle-step-3" class="flex justify-between items-start cursor-pointer">
                        <div>
                            <h2 class="text-3xl font-semibold mb-0 neon-text-green font-orbitron">
                                <span class="text-4xl">3.</span> Ciptakan Gambar (AI Labs)
                            </h2>
                            <p class="text-gray-400 -mt-0 ml-10">Wujudkan prompt sinematik Anda menjadi gambar jadi.</p>
                        </div>
                        <!-- Ikon Toggle -->
                        <svg id="toggle-icon-3" class="w-8 h-8 text-white toggle-icon flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>

                    <!-- Konten yang Bisa Diminimalkan -->
                    <div id="content-step-3" class="collapsible-content mt-6">
                        <div class="space-y-4">
                            <div>
                                <label for="prompt-input-3" class="block text-sm font-medium text-gray-300 mb-2">Prompt Sinematik (dari Langkah 2):</label>
                                <!-- DIUBAH: rows="10" menjadi rows="12" -->
                                <textarea id="prompt-input-3" rows="12" class="w-full p-3 rounded-lg neon-input text-white placeholder-gray-500" placeholder="Kirim prompt dari Langkah 2..."></textarea>
                            </div>
                            
                            <div>
                                <label for="style-select" class="block text-sm font-medium text-gray-300 mb-2">Gaya Gambar</label>
                                <select id="style-select" class="w-full p-2.5 rounded-lg neon-input text-white">
                                    <option value="photorealistic" selected>Photorealistic</option>
                                    <option value="cinematic">Cinematic</option>
                                    <option value="anime">Anime</option>
                                    <option value="comic_book">Comic Book</option>
                                    <option value="digital_art">Digital Art</option>
                                    <option value="pixel_art">Pixel Art</option>
                                    <option value="line_art">Line Art</option>
                                    <option value="3d_model">3D Model</option>
                                    <option value="analog_film">Analog Film</option>
                                    <option value="neon_punk">Neon Punk</option>
                                    <option value="isometric">Isometric</option>
                                    <option value="low_poly">Low Poly</option>
                                    <option value="origami">Origami</option>
                                    <option value="cartoon">Cartoon</option>
                                    <option value="watercolor">Watercolor Painting</option>
                                    <option value="fantasy">Fantasy Art</option>
                                    <option value="cyberpunk">Cyberpunk</option>
                                </select>
                            </div>

                            <!-- === INI DIA FITUR KUNCI WAJAH (FACE REFERENCE) === -->
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Foto Referensi Wajah (Kunci Wajah):</label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <!-- Slot Wajah 1 --><div>
                                        <input type="file" id="face-ref-input-1" class="hidden" accept="image/*">
                                        <button id="upload-ref-button-1" type="button" class="w-full text-center p-3 rounded-lg bg-gray-800 border border-dashed border-gray-600 hover:bg-gray-700 transition-colors btn-ghost-neon">
                                            Wajah 1
                                        </button>
                                        <div id="face-ref-preview-container-1" class="hidden mt-2 p-2 rounded-lg bg-gray-900/50 flex items-center justify-between">
                                            <div class="flex items-center gap-3">
                                                <img id="face-ref-thumbnail-1" src="" alt="Face Reference 1" class="w-12 h-12 rounded-md object-cover">
                                                <span id="face-ref-filename-1" class="text-sm text-gray-300 truncate"></span>
                                            </div>
                                            <button id="remove-ref-button-1" type="button" class="text-gray-400 hover:text-white">&times;</button>
                                        </div>
                                    </div>
                                    <!-- Slot Wajah 2 --><div>
                                        <input type="file" id="face-ref-input-2" class="hidden" accept="image/*">
                                        <button id="upload-ref-button-2" type="button" class="w-full text-center p-3 rounded-lg bg-gray-800 border border-dashed border-gray-600 hover:bg-gray-700 transition-colors btn-ghost-neon">
                                            Wajah 2
                                        </button>
                                        <div id="face-ref-preview-container-2" class="hidden mt-2 p-2 rounded-lg bg-gray-900/50 flex items-center justify-between">
                                            <div class="flex items-center gap-3">
                                                <img id="face-ref-thumbnail-2" src="" alt="Face Reference 2" class="w-12 h-12 rounded-md object-cover">
                                                <span id="face-ref-filename-2" class="text-sm text-gray-300 truncate"></span>
                                            </div>
                                            <button id="remove-ref-button-2" type="button" class="text-gray-400 hover:text-white">&times;</button>
                                        </div>
                                    </div>
                                    <!-- Slot Wajah 3 --><div>
                                        <input type="file" id="face-ref-input-3" class="hidden" accept="image/*">
                                        <button id="upload-ref-button-3" type="button" class="w-full text-center p-3 rounded-lg bg-gray-800 border border-dashed border-gray-600 hover:bg-gray-700 transition-colors btn-ghost-neon">
                                            Wajah 3
                                        </button>
                                        <div id="face-ref-preview-container-3" class="hidden mt-2 p-2 rounded-lg bg-gray-900/50 flex items-center justify-between">
                                            <div class="flex items-center gap-3">
                                                <img id="face-ref-thumbnail-3" src="" alt="Face Reference 3" class="w-12 h-12 rounded-md object-cover">
                                                <span id="face-ref-filename-3" class="text-sm text-gray-300 truncate"></span>
                                            </div>
                                            <button id="remove-ref-button-3" type="button" class="text-gray-400 hover:text-white">&times;</button>
                                        </div>
                                    </div>
                                    <!-- Slot Wajah 4 --><div>
                                        <input type="file" id="face-ref-input-4" class="hidden" accept="image/*">
                                        <button id="upload-ref-button-4" type="button" class="w-full text-center p-3 rounded-lg bg-gray-800 border border-dashed border-gray-600 hover:bg-gray-700 transition-colors btn-ghost-neon">
                                            Wajah 4
                                        </button>
                                        <div id="face-ref-preview-container-4" class="hidden mt-2 p-2 rounded-lg bg-gray-900/50 flex items-center justify-between">
                                            <div class="flex items-center gap-3">
                                                <img id="face-ref-thumbnail-4" src="" alt="Face Reference 4" class="w-12 h-12 rounded-md object-cover">
                                                <span id="face-ref-filename-4" class="text-sm text-gray-300 truncate"></span>
                                            </div>
                                            <button id="remove-ref-button-4" type="button" class="text-gray-400 hover:text-white">&times;</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- === AKHIR BAGIAN KUNCI WAJAH === -->

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <button id="reset-button-3" class="w-full btn btn-ghost-neon">
                                    Reset
                                </button>
                                <button id="generate-button-3" class="w-full btn btn-neon-green">
                                    Generate Gambar
                                </button>
                            </div>
                        </div>
                    </div> <!-- Akhir Konten Collapsible Langkah 3 -->
                </section>

                <!-- Hasil Langkah 3 -->
                <section id="result-section-3" class="hidden mt-8">
                    <h2 class="text-2xl font-semibold mb-4 neon-text-green font-orbitron">? Hasil Gambar Anda</h2>
                    <div id="loading-indicator-3" class="text-center p-8 glass-card rounded-xl">
                        <div class="spinner mx-auto"></div>
                        <p class="mt-4 text-gray-300 neon-text-green font-orbitron text-lg">MENCIPTAKAN GAMBAR...</p>
                    </div>
                    <div id="generated-image-content" class="hidden glass-card rounded-xl p-6 md:p-8">
                        
                        <div id="image-display-container" class="relative">
                            
                            <div id="original-image-container" class="hidden mb-6">
                                <h4 class="text-gray-400 text-sm mb-2 font-semibold">GAMBAR SEBELUM DIEDIT</h4>
                                <img id="original-image" src="" alt="Original Image" class="w-full h-auto rounded-lg shadow-md opacity-75 mb-3">
                                <!-- TOMBOL UNDUH BARU DITAMBAHKAN DI SINI -->
                                <button id="download-original-button" class="w-full btn btn-ghost-green text-sm">
                                    Unduh Gambar "Sebelum" Ini
                                </button>
                            </div>

                            <h4 id="latest-image-title" class="text-gray-400 text-sm mb-2 font-semibold hidden">HASIL EDIT TERBARU</h4>
                            <img id="generated-image" src="" alt="Generated Image" class="w-full h-auto rounded-lg shadow-lg mb-4">
                        </div>
                        <div class="mb-4">
                            <h3 class="text-gray-400 text-sm">PROMPT DIGUNAKAN (LENGKAP)</h3>
                            <p id="used-prompt-image" class="text-white font-medium"></p>
                        </div>
                        <div class="mb-4">
                            <h3 class="text-gray-400 text-sm">GAYA</h3>
                            <p id="used-style-image" class="text-white font-medium capitalize"></p>
                        </div>
                        <div class="space-y-3">
                            <button id="download-button" class="w-full btn btn-neon-blue">
                                Unduh Gambar (Hasil Terbaru)
                            </button>
                            <!-- TOMBOL BARU DITAMBAHKAN DI SINI -->
                            <button id="send-to-pose-button" class="w-full btn btn-neon-orange">
                                Kirim ke AI Pose
                                <svg class="w-5 h-5 inline-block ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </button>
                            <button id="send-to-upscaler-button" class="w-full btn btn-futuristic text-white text-base font-bold py-3 px-8 rounded-lg">
                                Kirim ke Upscaler 4x
                                <svg class="w-5 h-5 inline-block ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11l3-3m0 0l3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z"></path></svg>
                            </button>
                        </div>

                        <!-- Edit Gambar (In-painting/Out-painting) -->
                        <div id="edit-section" class="mt-6 pt-6 border-t border-gray-700/50">
                            <h3 class="text-xl font-semibold mb-3 neon-text-orange">?? Sempurnakan Gambar</h3>
                            <p class="text-gray-400 mb-4 text-sm">Instruksi untuk memperbaiki atau mengubah gambar (Contoh: "ubah warna rambut jadi merah").</p>
                            <div>
                                <label for="edit-prompt-input" class="block text-sm font-medium text-gray-300 mb-2">Instruksi Perubahan:</label>
                                <!-- DIUBAH: rows="4" menjadi rows="5" -->
                                <textarea id="edit-prompt-input" rows="5" class="w-full p-3 rounded-lg neon-input text-white placeholder-gray-500" placeholder="Contoh: 'rubah bajunya menjadi putih'"></textarea>
                            </div>
                            <button id="regenerate-button" class="w-full mt-4 btn btn-neon-orange">
                                Generate Ulang (Edit)
                            </button>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- === KONEKTOR LANGKAH (BARU) === -->
            <div class="step-connector">
                <span class="step-icon" style="border-color: var(--neon-green); box-shadow: 0 0 10px var(--neon-green); color: var(--neon-green);">
                    <svg class="w-6 h-6 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2a8.001 8.001 0 0015.357 2m0 0H15"></path></svg>
                </span>
            </div>
            
            <!-- === APLIKASI 4 (BARU): POSE GENERATOR === -->
            <section id="pose-app-container" class="glass-card rounded-xl p-6 md:p-8">
                <!-- Header App Pose -->
                <header class="text-center mb-8">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500 font-orbitron">
                        AI Labs Pose by PRO
                    </h1>
                    <p class="text-lg text-gray-300 mt-2">Unggah wajah Anda dan ciptakan pose baru.</p>
                </header>
                
                <!-- Konten App Pose -->
                <div class="grid grid-cols-1 md:col-span-1 md:grid-cols-3 gap-6">
                    
                    <div class="md:col-span-1 space-y-6">
                        <!-- Card 1: Upload (Menggunakan glass-card) -->
                        <div class="glass-card p-6 rounded-lg">
                            <h2 class="text-xl font-bold mb-4 border-b border-white/10 pb-2">1. Unggah Foto Wajah</h2>
                            <p class="text-sm text-gray-300 mb-4">Pastikan wajah terlihat jelas. (Atau kirim dari Langkah 3)</p>
                            <input type="file" id="image-upload" accept="image/jpeg, image/png, image/webp" class="block w-full text-sm text-gray-300
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-orange-600 file:text-white
                                hover:file:bg-orange-700 cursor-pointer">
                            <div class="mt-4 border border-white/20 rounded-lg overflow-hidden aspect-square">
                                <img id="preview" src="https://placehold.co/400x400/334155/E2E8F0?text=Pratinjau+Gambar" alt="Pratinjau Gambar" class="w-full h-full object-cover">
                            </div>
                        </div>
                        
                        <!-- Card 2: Opsi (Menggunakan glass-card) -->
                        <div class="glass-card p-6 rounded-lg">
                            <h2 class="text-xl font-bold mb-4 border-b border-white/10 pb-2">2. Opsi Tambahan</h2>
                            <div class="flex items-center justify-between mb-4">
                                <label for="watermark-toggle" class="font-medium text-lg">Watermark (On/Off)</label>
                                <input type="checkbox" id="watermark-toggle" class="h-6 w-6 rounded text-orange-500 focus:ring-orange-400 border-gray-400 bg-gray-700 cursor-pointer">
                            </div>
                            <div>
                                <label for="watermark-text" class="block text-sm font-medium text-gray-300 mb-2">Teks Watermark (Kustom):</label>
                                <!-- Menggunakan neon-input -->
                                <input type="text" id="watermark-text" placeholder="Ketik teks Anda di sini..." class="w-full neon-input rounded-lg px-3 py-2 placeholder-gray-400">
                            </div>
                        </div>
                        
                        <!-- Tombol Generate (Menggunakan btn) -->
                        <button id="generate-btn" class="w-full btn btn-neon-orange text-white font-bold py-4 px-6 rounded-lg shadow-lg text-xl transition-all duration-300 transform hover:scale-105">
                            Hasilkan 3 Pose Acak
                        </button>
                        
                        <div id="error-message" class="text-red-400 text-center font-medium"></div>
                    </div>
                    
                    <!-- Kolom Hasil (Menggunakan glass-card) -->
                    <div class="md:col-span-2 glass-card p-6 rounded-lg">
                        <h2 class="text-xl font-bold mb-4 border-b border-white/10 pb-2">3. Hasil Gambar</h2>
                        
                        <div id="loader" class="hidden flex-col items-center justify-center h-64">
                            <div class="loader-pose"></div> <!-- Menggunakan .loader-pose -->
                            <p class="mt-4 text-lg text-gray-300">AI sedang bekerja... Mohon tunggu.</p>
                        </div>
                        
                        <div id="results-container" class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                            <!-- Hasil akan muncul di sini -->
                        </div>
                    </div>
                </div>
                
                <footer class="text-center text-gray-400 mt-8 pb-6">
                     Di buat oleh Bang pro
                </footer>
            </section>

        </main>
    
            <!-- === PEMISAH APLIKASI === -->
            <div class="my-16 md:my-24 border-t-2 border-dashed border-gray-700"></div>
    
            <!-- === APLIKASI 5: BANG PRO UPSCALER (Sebelumnya 2) === -->
            <div class="w-full max-w-4xl mx-auto" id="upscaler-app-container">
                <div class="card-glow rounded-2xl p-6 md:p-8 shadow-2xl">
                
                <!-- Header -->
                <header class="text-center mb-6">
                    <div class="flex items-center justify-center gap-4 mb-2">
                        <svg class="w-12 h-12 text-cyan-400" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16.12,9.45a4.4,4.4,0,1,1-8.24,0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 12.5V17.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h1 class="font-orbitron text-3xl md:text-4xl font-bold tracking-widest text-white">
                            BANG <span class="text-cyan-400">PRO</span>
                        </h1>
                    </div>
                    <p class="text-cyan-300 text-lg">AI Image Upscaler</p>
                </header>

                <!-- Upload Section -->
                <div id="upload-section">
                    <label for="file-upload" id="drop-zone" class="drop-zone-border cursor-pointer flex flex-col items-center justify-center p-8 md:p-12 rounded-lg text-center transition-all duration-300 hover:bg-cyan-500/10">
                        <svg class="w-16 h-16 text-cyan-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                        <p class="text-lg font-semibold text-white">Seret & Lepas gambar di sini</p>
                        <p class="text-gray-400">atau klik untuk memilih file</p>
                        <p class="text-xs text-gray-500 mt-2">Mendukung: JPG, PNG, WEBP</p>
                    </label>
                    <input type="file" id="file-upload" class="hidden" accept="image/png, image/jpeg, image/webp">
                    
                    <div class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
                        <label for="scale-factor" class="font-semibold text-white">Skala Upscale:</label>
                        <select id="scale-factor" class="bg-gray-700 border border-cyan-500/50 text-white rounded-md px-4 py-2 focus:ring-2 focus:ring-cyan-400 focus:outline-none">
                            <option value="2">2x</option>
                            <option value="4" selected>4x</option>
                            <option value="8">8x</option>
                        </select>
                    </div>
                </div>

                <!-- Loading Section -->
                <div id="loading-section" class="hidden flex-col items-center justify-center py-16">
                    <div class="loader"></div> <!-- Menggunakan .loader (futuristic) -->
                    <p class="font-orbitron text-xl mt-8 text-cyan-300 animate-pulse">MEMPROSES CITRA...</p>
                </div>

                <!-- Result Section -->
                <div id="result-section" class="hidden">
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Original Image -->
                        <div>
                            <h3 class="font-orbitron text-xl text-center mb-3 text-white">Original</h3>
                            <div class="bg-black/30 p-2 rounded-lg border border-gray-700">
                               <canvas id="original-canvas" class="w-full h-auto rounded"></canvas>
                            </div>
                            <p id="original-dim" class="text-center text-sm text-gray-400 mt-2"></p>
                        </div>
                        <!-- Upscaled Image -->
                        <div>
                            <h3 class="font-orbitron text-xl text-center mb-3 text-cyan-400">Hasil Upscaled</h3>
                             <div class="bg-black/30 p-2 rounded-lg border border-cyan-500/50">
                                <canvas id="upscaled-canvas" class="w-full h-auto rounded"></canvas>
                             </div>
                            <p id="upscaled-dim" class="text-center text-sm text-cyan-300 mt-2"></p>
                        </div>
                    </div>
                    <div class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
                        <a id="download-btn" href="#" download="upscaled-image.png" class="btn-download w-full sm:w-auto text-center text-white font-bold py-3 px-8 rounded-lg text-lg">
                            Unduh Gambar
                        </a>
                        <button id="reset-btn" class="w-full sm:w-auto bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors">
                            Coba Gambar Lain
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- === PEMISAH APLIKASI BARU === -->
        <div class="my-16 md:my-24 border-t-2 border-dashed border-gray-700"></div>
        
        <!-- === BARU: APLIKASI 6: REMIX PROMPT AILABS === -->
        <!-- Konten dari aplikasi baru disisipkan di sini -->
        <!-- Latar belakang .app-background tidak digunakan agar tidak bentrok dengan tema utama -->
        <div class="max-w-4xl mx-auto relative p-0 md:p-4 z-10" id="remix-app-container"> <!-- Menggunakan p-0 md:p-4 agar pas -->
            
            <!-- Header (dari tema baru, judul disesuaikan) -->
            <header class="sticky top-0 z-20 w-full p-4 rounded-xl glass-panel mb-8 shadow-2xl">
                <div class="flex items-center justify-between">
                    <!-- Judul Utama: Diubah -->
                    <h1 class="text-xl sm:text-2xl font-black tracking-wider neon-cyan-text" data-key="title">
                        REMIX PROMPT AILABS
                    </h1>
                    
                    <!-- Grup Kontrol Header BARU -->
                    <div class="flex items-center gap-4">
                        <!-- Tombol Bahasa BARU -->
                        <div class="flex items-center gap-2 text-sm font-medium">
                            <button id="lang-id" class="text-white opacity-100 font-bold transition" onclick="setLanguage('id')">ID</button>
                            <span class="text-gray-600">|</span>
                            <button id="lang-en" class="text-gray-400 opacity-70 transition" onclick="setLanguage('en')">EN</button>
                        </div>
                        
                        <!-- Logo PRO -->
                        <div class="relative h-10 px-3 rounded-full border-2 border-[#FF7F50] flex items-center justify-center neon-orange-border bg-gray-900/50">
                            <span class="text-sm font-bold text-[#FF7F50] tracking-wider">by PRO</span>
                        </div>
                    </div>

                </div>
            </header>

            <!-- Konten Utama: Tampilan Atas-Bawah (Struktur lama, gaya baru) -->
            <main class="flex flex-col gap-6">
                
                <!-- PANEL 1: INPUT GAMBAR (DIPERBARUI) -->
                <div class="p-6 glass-panel rounded-xl">
                    <label class="text-lg font-bold mb-4 text-[#FF7F50] block" data-key="imageUploadLabel">
                        1. Ambil Prompt dari Gambar (Opsional)
                    </label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                        <!-- Kolom Upload -->
                        <div>
                            <input type="file" id="imageUpload" class="hidden" accept="image/png, image/jpeg, image/webp" onchange="handleImageUpload(event)">
                            <label for="imageUpload" id="imageUploadLabel" class="file-input-label">
                                <span id="imageUploadPlaceholder" class="text-center text-gray-400">
                                    <i data-lucide="upload-cloud" class="w-10 h-10 mx-auto mb-2 text-gray-500"></i>
                                    <span data-key="imageUploadPlaceholder">Klik atau seret gambar ke sini</span>
                                </span>
                                <img id="imagePreview" class="hidden" alt="Pratinau Gambar">
                            </label>
                        </div>
                        
                        <!-- Kolom Tombol (DIPERBARUI) -->
                        <div class="flex flex-col gap-4">
                            <!-- Tombol 1: Ekstrak Teks (OCR) -->
                            <button id="extractButton" class="w-full text-white bg-[#FF7F50] hover:bg-orange-600 font-bold py-3 px-4 rounded-xl neon-orange-glow transition duration-300 transform active:scale-95 disabled:bg-gray-600 disabled:opacity-50 disabled:shadow-none">
                                <span id="extractText" class="flex items-center justify-center">
                                    <i data-lucide="scan-text" class="w-5 h-5 mr-2 inline-block"></i> <span data-key="imageUploadButton">Ekstrak Teks</span>
                                </span>
                                <div id="extractLoading" class="hidden flex items-center justify-center">
                                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <span data-key="imageUploadLoading">Mengekstrak...</span>
                                </div>
                            </button>
                            
                            <!-- Tombol 2: Buat Prompt Detail (BARU) -->
                            <button id="readPromptButton" class="w-full text-white bg-cyan-600 hover:bg-cyan-500 font-bold py-3 px-4 rounded-xl neon-cyan-glow transition duration-300 transform active:scale-95 disabled:bg-gray-600 disabled:opacity-50 disabled:shadow-none">
                                <span id="readPromptText" class="flex items-center justify-center">
                                    <i data-lucide="eye" class="w-5 h-5 mr-2 inline-block"></i> <span data-key="readPromptButton">Buat Prompt Detail</span>
                                </span>
                                <div id="readPromptLoading" class="hidden flex items-center justify-center">
                                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <span data-key="readPromptLoading">Membaca...</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Kolom 2: Prompt Dasar (PENOMORAN DIUBAH) -->
                <div class="p-6 glass-panel rounded-xl">
                    <label for="basePrompt" class="text-lg font-bold mb-4 text-[#FF7F50] block" data-key="basePromptLabel">
                        2. Prompt Dasar
                    </label>
                    <textarea id="basePrompt" 
                                class="themed-textarea" 
                                placeholder="Masukkan prompt dasar Anda di sini...&#10;&#10;Contoh:&#10;Seekor kucing oranye gemuk sedang tidur di atas tumpukan buku."></textarea>
                </div>
                
                <!-- Kolom 3: Perintah Remix (PENOMORAN DIUBAH) -->
                <div class="p-6 glass-panel rounded-xl">
                    <label for="remixInstruction" class="text-lg font-bold mb-4 text-[#FF7F50] block" data-key="remixInstructionLabel">
                        3. Perintah Remix
                    </label>
                    <textarea id="remixInstruction" 
                                class="themed-textarea" 
                                placeholder="Apa yang ingin Anda ubah?&#10;&#10;Contoh:&#10;Ubah menjadi gaya sinematik, pencahayaan dramatis, dan tambahkan suasana hujan di luar jendela."></textarea>
                </div>
                
                <!-- Tombol Aksi dan Pesan (DIPERBARUI DENGAN TOMBOL RESET) -->
                <div class="text-center">
                    <!-- BARU: Flex container untuk tombol -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-center max-w-2xl mx-auto">
                        <!-- BARU: Tombol Reset -->
                        <button id="resetButton" class="w-full sm:w-1/3 text-[#FF7F50] bg-transparent hover:bg-[#FF7F50]/20 font-bold py-3 px-4 rounded-xl border border-[#FF7F50] transition duration-300 transform active:scale-95 disabled:opacity-50">
                            <span id="resetText" class="flex items-center justify-center">
                                <i data-lucide="rotate-ccw" class="w-5 h-5 mr-2 inline-block"></i> <span data-key="resetButton">Reset</span>
                            </span>
                        </button>
                        
                        <!-- Tombol Remix (Disesuaikan) -->
                        <button id="remixButton" class="w-full sm:w-2/3 text-white bg-cyan-600 hover:bg-cyan-500 font-bold py-3 px-4 rounded-xl neon-cyan-glow transition duration-300 transform active:scale-95 disabled:bg-gray-600 disabled:opacity-50 disabled:shadow-none">
                            <span id="generateText" class="flex items-center justify-center">
                                <i data-lucide="sparkles" class="w-5 h-5 mr-2 inline-block"></i> <span data-key="remixButton">Remix Prompt</span>
                            </span>
                            <div id="loadingIndicator" class="hidden flex items-center justify-center">
                                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span data-key="loadingText">Memproses...</span>
                            </div>
                        </button>
                    </div>
                    <div id="messageBox" class="text-red-400 mt-4 h-6 text-sm"></div>
                </div>

                <!-- Kolom 4: Hasil Remix (PENOMORAN DIUBAH) -->
                <div class="p-6 glass-panel rounded-xl">
                    <!-- Wrapper BARU untuk Label dan Tombol Salin -->
                    <div class="flex justify-between items-center mb-4">
                        <label for="resultPrompt" class="text-lg font-bold text-[#FF7F50] block" data-key="resultPromptLabel">
                            4. Hasil Remix
                        </label>
                        <!-- Grup Tombol Baru -->
                        <div class="flex gap-2">
                            <!-- Tombol "Gunakan" BARU -->
                            <button id="useAsBaseButton" onclick="useResultAsBase()" class="text-cyan-400 bg-transparent hover:bg-cyan-500/20 font-bold py-2 px-3 rounded-lg border border-cyan-500 transition text-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span id="useAsBaseIconWrapper" class="inline-block">
                                    <i data-lucide="arrow-up-circle" class="w-4 h-4"></i>
                                </span>
                                <span data-key="useAsBaseButton" class="ml-1">Gunakan</span>
                            </button>
                            
                            <!-- Tombol Salin BARU -->
                            <button id="copyButton" onclick="copyToClipboard()" class="text-[#FF7F50] bg-transparent hover:bg-[#FF7F50]/20 font-bold py-2 px-3 rounded-lg border border-[#FF7F50] transition text-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                <!-- PERBAIKAN: Menambahkan span wrapper untuk ikon -->
                                <span id="copyIconWrapper" class="inline-block">
                                    <i data-lucide="copy" class="w-4 h-4"></i>
                                </span>
                                <span data-key="copyButton" class="ml-1">Salin</span>
                            </button>
                        </div>
                    </div>
                    <textarea id="resultPrompt" 
                                class="themed-textarea" 
                                placeholder="Hasil prompt yang di-remix akan muncul di sini..." 
                                readonly></textarea>
                    
                    <!-- BARU: Tombol Kirim ke Ciptakan Gambar -->
                    <div class="mt-4 flex flex-col sm:flex-row gap-4">
                        <!-- Tombol Kirim ke Sempurnakan (Langkah 2) -->
                        <button id="send-remix-to-step-2" class="w-full sm:w-1/2 btn btn-neon-blue flex items-center justify-center">
                            <i data-lucide="send-to-back" class="w-5 h-5 mr-2"></i>
                            Kirim ke Sempurnakan (Lgkh 2)
                        </button>
                        <!-- Tombol Kirim ke Ciptakan (Langkah 3) -->
                        <button id="send-remix-to-step-3" class="w-full sm:w-1/2 btn btn-neon-green flex items-center justify-center">
                            <i data-lucide="send" class="w-5 h-5 mr-2"></i>
                            Kirim ke Ciptakan (Lgkh 3)
                        </button>
                    </div>
                </div>
                
            </main>
        </div>
        <!-- === AKHIR APLIKASI REMIX PROMPT === -->


    </div> <!-- Akhir Kontainer Utama -->

    <script>
        // === GLOBAL HELPER FUNCTIONS ===
        
        // --- Fungsi Modal Kustom ---
        function showModal(message, type = 'default') {
            const oldModal = document.getElementById('custom-modal');
            if (oldModal) oldModal.remove();
            
            let btnClass = 'btn-neon-orange';
            if (type === 'success') btnClass = 'btn-neon-green';
            if (type === 'error') btnClass = 'btn-neon-orange'; // Or a red one if defined

            const modal = document.createElement('div');
            modal.id = 'custom-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `<div class="glass-card rounded-lg p-6 text-center shadow-xl max-w-sm mx-auto">
                                   <p class="text-white text-lg mb-6">${message}</p>
                                   <button onclick="this.parentElement.parentElement.remove()" class="btn ${btnClass} font-bold px-8 py-2 rounded-lg">OK</button>
                               </div>`;
            document.body.appendChild(modal);
        }

        // --- Fungsi Base64 ---
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }
        
        // --- Fungsi Helper 'Lainnya' ---
        function setupCustomInputListener(selectId, inputId) {
            const select = document.getElementById(selectId);
            const input = document.getElementById(inputId);
            if (!select || !input) return;
            select.addEventListener('change', () => {
                input.classList.toggle('hidden', select.value !== 'lainnya');
            });
        }

        // --- Fungsi Copy to Clipboard ---
        function setupCopyButton(buttonId, outputId, successMessage) {
            const button = document.getElementById(buttonId);
            const output = document.getElementById(outputId);
            if (!button || !output) return;
            
            const originalIcon = button.innerHTML;
            const successIcon = `<svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;

            button.addEventListener('click', () => {
                if (!output.value) {
                    showModal("Tidak ada teks untuk disalin.", 'error');
                    return;
                }
                
                try {
                    // Metode modern (jika dalam konteks aman)
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(output.value);
                    } else {
                        // Fallback untuk 'document.execCommand'
                        output.select();
                        document.execCommand('copy');
                    }

                    button.innerHTML = successIcon;
                    button.title = "Tersalin!";
                    showModal(successMessage, 'success');

                    setTimeout(() => {
                        button.innerHTML = originalIcon;
                        button.title = "Salin ke Clipboard";
                    }, 2000);

                } catch (err) {
                    console.error('Gagal menyalin:', err);
                    showModal('Gagal menyalin. Coba salin manual.', 'error');
                }
            });
        }


        // === LANGKAH 1: AVATAR PROMPT GENERATOR ===
        (function step1_AvatarPrompt() {
            const form = document.getElementById('prompt-form');
            const outputPrompt1 = document.getElementById('output-prompt-1');
            
            const inputsToMonitor = [
                'cat1_tipe_shot', 'cat1_tipe_shot_kustom',
                'cat2_kamera', 'cat2_kamera_kustom', 'cat2_teknis', 'cat2_teknis_kustom', 'cat2_kualitas', 'cat2_kualitas_kustom',
                'cat3_gender_etnis', 'cat3_gender_etnis_kustom', 'cat3_bentuk_tubuh', 'cat3_bentuk_tubuh_kustom', 'cat3_rambut', 'cat3_rambut_kustom', 'cat3_wajah', 'cat3_wajah_kustom',
                'cat4_pose', 'cat4_pose_kustom',
                'cat5_baju', 'cat5_baju_kustom', 'cat5_celana', 'cat5_celana_kustom', 'cat5_aksesoris', 'cat5_aksesoris_kustom', 'cat5_riasan', 'cat5_riasan_kustom', 'cat5_tato', 'cat5_tato_kustom',
                'cat6_pencahayaan', 'cat6_pencahayaan_kustom',
                'cat7_latar', 'cat7_latar_kustom',
                'cat8_style', 'cat8_style_kustom'
            ];
            
            // Setup listeners untuk input 'lainnya'
            setupCustomInputListener('cat1_tipe_shot', 'cat1_tipe_shot_kustom');
            setupCustomInputListener('cat2_kamera', 'cat2_kamera_kustom');
            setupCustomInputListener('cat2_teknis', 'cat2_teknis_kustom');
            setupCustomInputListener('cat2_kualitas', 'cat2_kualitas_kustom');
            setupCustomInputListener('cat3_gender_etnis', 'cat3_gender_etnis_kustom');
            setupCustomInputListener('cat3_bentuk_tubuh', 'cat3_bentuk_tubuh_kustom');
            setupCustomInputListener('cat3_rambut', 'cat3_rambut_kustom');
            setupCustomInputListener('cat3_wajah', 'cat3_wajah_kustom');
            setupCustomInputListener('cat4_pose', 'cat4_pose_kustom');
            setupCustomInputListener('cat5_baju', 'cat5_baju_kustom');
            setupCustomInputListener('cat5_celana', 'cat5_celana_kustom');
            setupCustomInputListener('cat5_aksesoris', 'cat5_aksesoris_kustom');
            setupCustomInputListener('cat5_riasan', 'cat5_riasan_kustom');
            setupCustomInputListener('cat5_tato', 'cat5_tato_kustom');
            setupCustomInputListener('cat6_pencahayaan', 'cat6_pencahayaan_kustom');
            setupCustomInputListener('cat7_latar', 'cat7_latar_kustom');
            setupCustomInputListener('cat8_style', 'cat8_style_kustom');

            // Fungsi untuk mendapatkan nilai kustom
            const getCustomValue = (selectId, inputId) => {
                const select = document.getElementById(selectId);
                if (!select) return ''; // Guard clause
                return select.value === 'lainnya' ? document.getElementById(inputId).value.trim() : select.value;
            };

            // Fungsi untuk generate prompt Langkah 1
            function generateAvatarPrompt() {
                const values = {
                    cat1: getCustomValue('cat1_tipe_shot', 'cat1_tipe_shot_kustom'),
                    cat2_cam: getCustomValue('cat2_kamera', 'cat2_kamera_kustom'),
                    cat2_tech: getCustomValue('cat2_teknis', 'cat2_teknis_kustom'),
                    cat2_qual: getCustomValue('cat2_kualitas', 'cat2_kualitas_kustom'),
                    cat3_sub: getCustomValue('cat3_gender_etnis', 'cat3_gender_etnis_kustom'),
                    cat3_body: getCustomValue('cat3_bentuk_tubuh', 'cat3_bentuk_tubuh_kustom'),
                    cat3_hair: getCustomValue('cat3_rambut', 'cat3_rambut_kustom'),
                    cat3_face: getCustomValue('cat3_wajah', 'cat3_wajah_kustom'),
                    cat4: getCustomValue('cat4_pose', 'cat4_pose_kustom'),
                    cat5_baju: getCustomValue('cat5_baju', 'cat5_baju_kustom'),
                    cat5_celana: getCustomValue('cat5_celana', 'cat5_celana_kustom'),
                    cat5_acc: getCustomValue('cat5_aksesoris', 'cat5_aksesoris_kustom'),
                    cat5_makeup: getCustomValue('cat5_riasan', 'cat5_riasan_kustom'),
                    cat5_tattoo: getCustomValue('cat5_tato', 'cat5_tato_kustom'),
                    cat6: getCustomValue('cat6_pencahayaan', 'cat6_pencahayaan_kustom'),
                    cat7: getCustomValue('cat7_latar', 'cat7_latar_kustom'),
                    cat8: getCustomValue('cat8_style', 'cat8_style_kustom'),
                };

                let promptParts = [
                    // Urutan prompt bisa diatur di sini
                    values.cat8, // Style/Genre (seringkali bagus di awal)
                    values.cat1, // Tipe Shot
                    
                    // Subjek
                    values.cat3_sub,
                    values.cat3_body,
                    values.cat3_hair,
                    values.cat3_face,
                    
                    // Pose
                    values.cat4,
                    
                    // Pakaian & Aksesoris
                    values.cat5_baju,
                    values.cat5_celana,
                    values.cat5_acc,
                    values.cat5_makeup,
                    values.cat5_tattoo,
                    
                    // Latar & Cahaya
                    values.cat6,
                    values.cat7,

                    // Teknis (biasanya di akhir)
                    values.cat2_cam,
                    values.cat2_tech,
                    values.cat2_qual
                ];
                
                let
                promptText = promptParts.filter(Boolean).join(', ').replace(/\s+/g, ' ').trim();
                
                // Tambahkan titik di akhir jika belum ada
                if (promptText && !promptText.endsWith('.')) {
                    promptText += '.';
                }

                outputPrompt1.value = promptText;
            }

            // Monitor perubahan pada form
            inputsToMonitor.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', generateAvatarPrompt);
                    el.addEventListener('change', generateAvatarPrompt);
                }
            });

            // Setup tombol copy
            setupCopyButton('copy-button-1', 'output-prompt-1', 'Prompt deskriptif disalin!');
            
            // Initial generate saat load
            generateAvatarPrompt();
        })();


        // === LANGKAH 2: CINEMATIC TRANSFORMER ===
        (function step2_CinematicTransform() {
            const inputPrompt = document.getElementById('prompt-input-2');
            const outputPrompt = document.getElementById('output-prompt-2');
            const generateButton = document.getElementById('generate-cinematic-button');
            // DIHAPUS: const regenerateButton = document.getElementById('regenerate-cinematic-button');
            const loadingIndicator = document.getElementById('loading-indicator-2');
            const resultContainer = document.getElementById('result-step-2');

            // --- FUNGSI AI DIKEMBALIKAN ---
            // DIHAPUS: const apiKey = ""; // Kunci API Anda
            // DIHAPUS: const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const apiUrl = '/api/proxy.js'; // BARU: Panggil proxy Vercel

            // --- Instruksi AI yang Diperbarui (SANGAT SPESIFIK v2) ---
            const systemPrompt = `Anda adalah seorang 'AI Prompt Engineer' elit. Tugas Anda adalah mengambil prompt dasar dari pengguna dan mengubahnya menjadi 'Master Prompt' sinematik yang sangat terstruktur.
Anda HARUS mengambil prompt dasar pengguna (yang berisi subjek, pakaian, dll.) dan mengintegrasikannya ke dalam paragraf deskripsi utama.

Anda WAJIB mengikuti format di bawah ini dengan TEPAT. JANGAN menambah atau mengurangi header.

FORMAT WAJIB:

**Kunci Wajah Aktif**: Wajah subjek HARUS identik dengan foto referensi. Pertahankan semua fitur wajah asli tanpa perubahan.

[Paragraf Deskripsi Utama] - [Integrasikan prompt pengguna di sini. Buatlah menjadi paragraf deskriptif yang mengalir, menjelaskan subjek, pose, pakaian, ekspresi, dan latar belakang secara sinematik. Perkaya deskripsinya.]

*Kamera:* [Tentukan kamera dan lensa profesional, misal: Canon EOS R5, Canon RF 50mm f/1.2 L USM. Sertakan pengaturan seperti shutter speed, f-stop dan ISO.]
*Detail:* [Tambahkan detail teknis sinematik. Jelaskan pencahayaan (misal: 'cahaya alami yang keras sebagai pencahayaan samping'), kedalaman bidang ('deep depth of field', 'fokus tajam'), dan tekstur ('tekstur kulit sangat mendetail', 'serat kain terlihat').]
*Kualitas:* [Selalu sertakan: 'Detail tinggi, 8K, mahakarya, fotografi sinematik, ultra realistic, sharp focus.']

WATERMARK TAGS: OFFICIAL prompt Ailabs by PRO

PENTING: Jangan tambahkan ' \`\`\` ' atau komentar lain. Hanya berikan teks prompt yang sudah jadi sesuai format di atas.`;

            async function fetchCinematicPrompt() {
                const userQuery = inputPrompt.value.trim();
                if (!userQuery) {
                    showModal("Masukkan prompt deskriptif dari Langkah 1 terlebih dahulu.", 'error');
                    return;
                }

                generateButton.disabled = true;
                // DIHAPUS: regenerateButton.disabled = true;
                loadingIndicator.classList.remove('hidden');
                resultContainer.classList.add('hidden');
                outputPrompt.value = '';

                try {
                    const model = 'gemini-2.5-flash-preview-09-2025'; // BARU
                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        // BARU: Kirim model dan payload ke proxy
                        body: JSON.stringify({ model: model, payload: payload })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (!text) {
                        throw new Error("AI tidak memberikan respons teks.");
                    }
                    
                    outputPrompt.value = text.trim();
                    resultContainer.classList.remove('hidden');

                } catch (error) {
                    console.error("Error fetching cinematic prompt:", error);
                    showModal(`Gagal membuat prompt sinematik: ${error.message}`, 'error');
                } finally {
                    generateButton.disabled = false;
                    // DIHAPUS: regenerateButton.disabled = false;
                    loadingIndicator.classList.add('hidden');
                }
            }
            
            generateButton.addEventListener('click', fetchCinematicPrompt);
            // DIHAPUS: regenerateButton.addEventListener('click', fetchCinematicPrompt); // Tombol regenerate melakukan hal yang sama

            // Setup tombol copy
            setupCopyButton('copy-button-2', 'output-prompt-2', 'Prompt sinematik disalin!');
        })();


        // === LANGKAH 3: AI LABS IMAGE GENERATOR ===
        (function step3_ImageGenerator() {
            const promptInput = document.getElementById('prompt-input-3');
            const styleSelect = document.getElementById('style-select');
            const generateButton = document.getElementById('generate-button-3');
            const resetButton = document.getElementById('reset-button-3');
            
            const resultSection = document.getElementById('result-section-3');
            const loadingIndicator = document.getElementById('loading-indicator-3');
            const generatedImageContent = document.getElementById('generated-image-content');
            const generatedImage = document.getElementById('generated-image');
            const usedPromptImage = document.getElementById('used-prompt-image');
            const usedStyleImage = document.getElementById('used-style-image');
            
            const originalImageContainer = document.getElementById('original-image-container');
            const originalImage = document.getElementById('original-image');
            const latestImageTitle = document.getElementById('latest-image-title');
            
            const editPromptInput = document.getElementById('edit-prompt-input');
            const regenerateButton = document.getElementById('regenerate-button');

            const faceRefFiles = [null, null, null, null];
            let currentFullPrompt = ""; // Menyimpan prompt yang digunakan untuk generate

            // Setup Face Uploads
            function setupFaceUpload(slotIndex) {
                const input = document.getElementById(`face-ref-input-${slotIndex}`);
                const button = document.getElementById(`upload-ref-button-${slotIndex}`);
                const previewContainer = document.getElementById(`face-ref-preview-container-${slotIndex}`);
                const thumbnail = document.getElementById(`face-ref-thumbnail-${slotIndex}`);
                const filename = document.getElementById(`face-ref-filename-${slotIndex}`);
                const removeButton = document.getElementById(`remove-ref-button-${slotIndex}`);
                
                if (!input || !button || !previewContainer || !thumbnail || !filename || !removeButton) return;

                button.addEventListener('click', () => input.click());
                input.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        faceRefFiles[slotIndex - 1] = file;
                        const reader = new FileReader();
                        reader.onload = (e) => { thumbnail.src = e.target.result; };
                        reader.readAsDataURL(file);
                        filename.textContent = file.name;
                        previewContainer.classList.remove('hidden');
                        button.classList.add('hidden');
                    }
                });
                removeButton.addEventListener('click', () => clearFaceRef(slotIndex));
            }

            function clearFaceRef(slotIndex) {
                const input = document.getElementById(`face-ref-input-${slotIndex}`);
                const button = document.getElementById(`upload-ref-button-${slotIndex}`);
                const previewContainer = document.getElementById(`face-ref-preview-container-${slotIndex}`);
                
                faceRefFiles[slotIndex - 1] = null;
                input.value = '';
                previewContainer.classList.add('hidden');
                button.classList.remove('hidden');
            }

            for (let i = 1; i <= 4; i++) {
                setupFaceUpload(i);
            }

            // Reset Button
            resetButton.addEventListener('click', () => {
                promptInput.value = '';
                styleSelect.selectedIndex = 0;
                for (let i = 1; i <= 4; i++) {
                    clearFaceRef(i);
                }
                resultSection.classList.add('hidden');
                editPromptInput.value = '';
                originalImageContainer.classList.add('hidden');
                originalImage.src = '';
                latestImageTitle.classList.add('hidden');
            });

            // Fungsi Panggil API Gambar
            async function callImageApi(parts) {
                // DIHAPUS: const apiKey = ""; // API Key Anda
                // DIHAPUS: const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const apiUrl = '/api/proxy.js'; // BARU: Panggil proxy Vercel
                
                const model = 'gemini-2.5-flash-image-preview'; // BARU
                const payload = { contents: [{ parts }], generationConfig: { responseModalities: ['TEXT', 'IMAGE'] } };
                
                // Retry logic
                let response;
                for (let i = 0; i < 3; i++) { // Coba maks 3x
                    try {
                        response = await fetch(apiUrl, { 
                            method: 'POST', 
                            headers: { 'Content-Type': 'application/json' }, 
                            // BARU: Kirim model dan payload ke proxy
                            body: JSON.stringify({ model: model, payload: payload }) 
                        });
                        if (response.ok) break;
                        if (response.status === 429 || response.status >= 500) {
                            await new Promise(res => setTimeout(res, (i + 1) * 1000)); // Backoff
                            continue;
                        }
                        throw new Error(`Status: ${response.status}`);
                    } catch (e) {
                        if (i === 2) throw e;
                    }
                }

                if (!response.ok) throw new Error(`Gagal menghubungi server AI (Status: ${response.status})`);
                
                const result = await response.json();
                if (!result.candidates || result.candidates.length === 0) throw new Error("AI tidak memberikan respons. Coba lagi.");
                
                const candidate = result.candidates[0];
                if (candidate.finishReason && candidate.finishReason !== 'STOP') {
                    if (candidate.finishReason === 'SAFETY') {
                        throw new Error("Generasi gambar diblokir karena alasan keamanan/kebijakan. Coba prompt yang berbeda.");
                    }
                    throw new Error(`Generasi gambar dihentikan: ${candidate.finishReason}.`);
                }
                
                const base64Data = candidate.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (!base64Data) throw new Error("Tidak ada gambar yang dihasilkan. Coba lagi dengan prompt yang berbeda.");
                
                return base64Data;
            }

            // Tombol Generate Utama (Langkah 3)
            generateButton.addEventListener('click', async () => {
                const prompt = promptInput.value.trim();
                if (!prompt) {
                    showModal("Mohon masukkan prompt sinematik dari Langkah 2.", 'error');
                    return;
                }

                generateButton.disabled = true;
                generateButton.textContent = 'Menciptakan...';
                resultSection.classList.remove('hidden');
                loadingIndicator.classList.remove('hidden');
                generatedImageContent.classList.add('hidden');
                resultSection.scrollIntoView({ behavior: 'smooth' });

                try {
                    currentFullPrompt = `${prompt}, in the style of ${styleSelect.options[styleSelect.selectedIndex].text}`;
                    const parts = [{ text: currentFullPrompt }];

                    let faceRefCount = 0;
                    for (let i = 0; i < faceRefFiles.length; i++) {
                        if (faceRefFiles[i]) {
                            parts.push({ inlineData: { mimeType: faceRefFiles[i].type, data: await fileToBase64(faceRefFiles[i]) } });
                            faceRefCount++;
                        }
                    }
                    
                    const base64Data = await callImageApi(parts);
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    
                    generatedImage.src = imageUrl;
                    editPromptInput.value = '';
                    
                    originalImageContainer.classList.add('hidden');
                    originalImage.src = '';
                    latestImageTitle.classList.add('hidden');

                    let promptInfo = currentFullPrompt;
                    if (faceRefCount > 0) {
                        promptInfo += ` (dengan ${faceRefCount} wajah referensi)`;
                    }
                    usedPromptImage.textContent = promptInfo;
                    usedStyleImage.textContent = styleSelect.value.replace(/_/g, ' ');

                } catch (error) {
                    console.error("Error generating image:", error);
                    showModal(`Terjadi kesalahan: ${error.message}`, 'error');
                } finally {
                    loadingIndicator.classList.add('hidden');
                    generatedImageContent.classList.remove('hidden');
                    generateButton.disabled = false;
                    generateButton.textContent = 'Generate Gambar';
                }
            });

            // Tombol Regenerate (Edit Gambar)
            regenerateButton.addEventListener('click', async () => {
                const editPrompt = editPromptInput.value.trim();
                if (!editPrompt) {
                    showModal("Mohon masukkan instruksi perubahan terlebih dahulu.", 'error');
                    return;
                }

                const currentImageSrc = generatedImage.src;
                if (!currentImageSrc.startsWith('data:image/')) {
                    showModal("Gambar referensi (hasil sebelumnya) tidak ditemukan.", 'error');
                    return;
                }
                
                regenerateButton.disabled = true;
                regenerateButton.textContent = 'Mengedit...';
                loadingIndicator.classList.remove('hidden');
                generatedImageContent.classList.add('hidden'); 
                resultSection.scrollIntoView({ behavior: 'smooth' });

                try {
                    const srcParts = currentImageSrc.split(';');
                    const mimeType = srcParts[0].split(':')[1];
                    const currentImageBase64 = srcParts[1].split(',')[1];

                    // Instruksi edit + gambar asli
                    const parts = [
                        { text: editPrompt },
                        { inlineData: { mimeType: mimeType, data: currentImageBase64 } }
                    ];
                    
                    let faceRefCount = 0;
                    for (let i = 0; i < faceRefFiles.length; i++) {
                        if (faceRefFiles[i]) {
                            parts.push({ inlineData: { mimeType: faceRefFiles[i].type, data: await fileToBase64(faceRefFiles[i]) } });
                            faceRefCount++;
                        }
                    }
                    
                    const beforeEditSrc = generatedImage.src;
                    const base64Data = await callImageApi(parts);
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    
                    originalImage.src = beforeEditSrc;
                    originalImageContainer.classList.remove('hidden');
                    generatedImage.src = imageUrl;
                    latestImageTitle.classList.remove('hidden');
                    
                    let promptInfo = `[EDIT]: ${editPrompt} | [ORIGINAL]: ${currentFullPrompt}`;
                     if (faceRefCount > 0) {
                        promptInfo += ` (dengan ${faceRefCount} wajah referensi)`;
                    }
                    usedPromptImage.textContent = promptInfo;
                    editPromptInput.value = '';

                } catch (error) {
                    console.error("Error regenerating image:", error);
                    showModal(`Terjadi kesalahan saat edit: ${error.message}`, 'error');
                } finally {
                    loadingIndicator.classList.add('hidden');
                    generatedImageContent.classList.remove('hidden');
                    regenerateButton.disabled = false;
                    regenerateButton.textContent = 'Generate Ulang (Edit)';
                }
            });
            
            // Tombol Download
            document.getElementById('download-button').addEventListener('click', () => {
                const link = document.createElement('a');
                link.href = generatedImage.src;
                link.download = `ai_labs_pro_v3_LATEST_${Date.now()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            // Tombol Download Original (Baru)
            document.getElementById('download-original-button').addEventListener('click', () => {
                if (!originalImage.src) {
                    showModal("Tidak ada gambar 'sebelum' untuk diunduh.", "error");
                    return;
                }
                const link = document.createElement('a');
                link.href = originalImage.src;
                link.download = `ai_labs_pro_v3_ORIGINAL_${Date.now()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            // TOMBOL BARU: Kirim ke Upscaler
            const sendToUpscalerButton = document.getElementById('send-to-upscaler-button');
            const upscalerAppContainer = document.getElementById('upscaler-app-container');

            if (sendToUpscalerButton && upscalerAppContainer) {
                sendToUpscalerButton.addEventListener('click', () => {
                    const currentImageSrc = generatedImage.src;
                    if (!currentImageSrc || !currentImageSrc.startsWith('data:image/')) {
                        showModal("Tidak ada gambar yang dihasilkan untuk di-upscale.", 'error');
                        return;
                    }

                    if (typeof window.triggerGlobalUpscale === 'function') {
                        // Kirim data URL ke fungsi upscaler global
                        window.triggerGlobalUpscale(currentImageSrc);
                        // Scroll ke upscaler
                        upscalerAppContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        showModal("Gambar dikirim ke Upscaler!", 'success');
                    } else {
                        console.error('Fungsi Upscaler (triggerGlobalUpscale) tidak ditemukan.');
                        showModal('Error: Fungsi upscaler tidak dapat diakses.', 'error');
                    }
                });
            }

            // === FUNGSI SINKRONISASI BARU ===
            // TOMBOL BARU: Kirim ke AI Pose
            const sendToPoseButton = document.getElementById('send-to-pose-button');
            const poseAppContainer = document.getElementById('pose-app-container');

            if (sendToPoseButton && poseAppContainer) {
                sendToPoseButton.addEventListener('click', () => {
                    const currentImageSrc = generatedImage.src;
                    if (!currentImageSrc || !currentImageSrc.startsWith('data:image/')) {
                        showModal("Tidak ada gambar yang dihasilkan untuk dikirim ke AI Pose.", 'error');
                        return;
                    }

                    if (typeof window.triggerGlobalPose === 'function') {
                        // Kirim data URL ke fungsi pose global
                        window.triggerGlobalPose(currentImageSrc);
                        // Scroll ke app pose
                        poseAppContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        showModal("Gambar dikirim ke AI Pose!", 'success');
                    } else {
                        console.error('Fungsi AI Pose (triggerGlobalPose) tidak ditemukan.');
                        showModal('Error: Fungsi AI Pose tidak dapat diakses.', 'error');
                    }
                });
            }

        })();


        // === BAGIAN 4: KONEKTOR ANTAR LANGKAH ===
        (function stepConnectors() {
            const output1 = document.getElementById('output-prompt-1');
            const input2 = document.getElementById('prompt-input-2');
            const sendTo2Button = document.getElementById('send-to-step-2');
            
            const output2 = document.getElementById('output-prompt-2');
            const input3 = document.getElementById('prompt-input-3');
            const sendTo3Button = document.getElementById('send-to-step-3');

            // Kirim dari Langkah 1 ke Langkah 2
            sendTo2Button.addEventListener('click', () => {
                if (!output1.value) {
                    showModal("Prompt di Langkah 1 masih kosong.", 'error');
                    return;
                }
                input2.value = output1.value;
                document.getElementById('step-2').scrollIntoView({ behavior: 'smooth', block: 'center' });
                showModal("Prompt deskriptif dikirim ke Langkah 2!", 'success');
            });

            // Kirim dari Langkah 2 ke Langkah 3
            sendTo3Button.addEventListener('click', () => {
                if (!output2.value) {
                    showModal("Prompt sinematik di Langkah 2 masih kosong. Klik 'Transformasi' dulu.", 'error');
                    return;
                }
                input3.value = output2.value;
                document.getElementById('step-3').scrollIntoView({ behavior: 'smooth', block: 'center' });
                showModal("Prompt sinematik dikirim ke Langkah 3!", 'success');
            });
        })();

        // === BAGIAN 5: APLIKASI UPSCALER ===
        (function upscalerApp() {
            // DOM Elements
            const uploadSection = document.getElementById('upload-section');
            const loadingSection = document.getElementById('loading-section');
            const resultSection = document.getElementById('result-section');
            
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-upload');
            const scaleFactorSelect = document.getElementById('scale-factor');
            
            const originalCanvas = document.getElementById('original-canvas');
            const upscaledCanvas = document.getElementById('upscaled-canvas');
            const originalDim = document.getElementById('original-dim');
            const upscaledDim = document.getElementById('upscaled-dim');
            
            const downloadBtn = document.getElementById('download-btn');
            const resetBtn = document.getElementById('reset-btn');

            // --- Event Listeners ---
            
            // Check if elements exist before adding listeners (to avoid errors if ID is missing)
            if (dropZone) {
                dropZone.addEventListener('click', () => fileInput.click());

                // --- Drag and Drop ---
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('dragover');
                });

                dropZone.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('dragover');
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('dragover');
                    const file = e.dataTransfer.files[0];
                    if (file) {
                        handleFile(file);
                    }
                });
            }

            if (fileInput) {
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        handleFile(file);
                    }
                });
            }
            
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    resultSection.classList.add('hidden');
                    uploadSection.classList.remove('hidden');
                    fileInput.value = ''; // Clear file input
                });
            }
            
            if (downloadBtn) {
                downloadBtn.addEventListener('click', () => {
                    const dataUrl = upscaledCanvas.toDataURL('image/png');
                    downloadBtn.href = dataUrl;
                });
            }

            // --- Core File Handling Logic ---
            function handleFile(file) {
                if (!file.type.startsWith('image/')) {
                    // Use the main app's modal
                    if(typeof showModal === 'function') {
                        showModal('Harap pilih file gambar (PNG, JPG, WEBP).', 'error');
                    } else {
                        alert('Harap pilih file gambar (PNG, JPG, WEBP).');
                    }
                    return;
                }

                // Show loader, hide upload section
                uploadSection.classList.add('hidden');
                loadingSection.classList.remove('hidden');

                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        // Simulate processing time for effect
                        setTimeout(() => {
                            processImage(img);
                            // Hide loader, show results
                            loadingSection.classList.add('hidden');
                            resultSection.classList.remove('hidden');
                        }, 1500); // 1.5 second delay for futuristic loading feel
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            // --- Image Processing and Canvas Drawing ---
            function processImage(img) {
                const scaleFactor = parseInt(scaleFactorSelect.value);
                
                const originalWidth = img.width;
                const originalHeight = img.height;
                const upscaledWidth = originalWidth * scaleFactor;
                // --- PERBAIKAN DI SINI ---
                const upscaledHeight = originalHeight * scaleFactor; // Sebelumnya 'scaleGactor'

                // --- Draw Original Image ---
                const ctxOriginal = originalCanvas.getContext('2d');
                originalCanvas.width = originalWidth;
                originalCanvas.height = originalHeight;
                ctxOriginal.drawImage(img, 0, 0);
                originalDim.textContent = `Dimensi: ${originalWidth} x ${originalHeight}`;

                // --- Draw Upscaled Image ---
                const ctxUpscaled = upscaledCanvas.getContext('2d');
                upscaledCanvas.width = upscaledWidth;
                upscaledCanvas.height = upscaledHeight;
                
                // Disable image smoothing to get a sharp, pixelated look
                ctxUpscaled.imageSmoothingEnabled = false;
                
                ctxUpscaled.drawImage(img, 0, 0, upscaledWidth, upscaledHeight);
                upscaledDim.textContent = `Dimensi: ${upscaledWidth} x ${upscaledHeight} (${scaleFactor}x)`;
                
                // Set download filename
                if (fileInput.files[0]) {
                    const originalFilename = fileInput.files[0].name.split('.').slice(0, -1).join('.');
                    downloadBtn.download = `${originalFilename}-upscaled-${scaleFactor}x.png`;
                } else {
                    downloadBtn.download = `upscaled-${scaleFactor}x.png`;
                }
            }

            // --- Fungsi Publik untuk Menerima Gambar dari Langkah 3 ---
            function triggerUpscaleFromDataURL(dataUrl) {
                // Tampilkan loader, sembunyikan upload
                uploadSection.classList.add('hidden');
                loadingSection.classList.remove('hidden');
                resultSection.classList.add('hidden'); // Sembunyikan hasil lama (jika ada)

                // Pastikan skala 4x yang terpilih
                scaleFactorSelect.value = "4";

                const img = new Image();
                img.onload = () => {
                    // Tunda sedikit untuk efek loading
                    setTimeout(() => {
                        processImage(img);
                        // Sembunyikan loader, tampilkan hasil
                        loadingSection.classList.add('hidden');
                        resultSection.classList.remove('hidden');
                    }, 1000); // 1 detik tunda
                };
                img.onerror = () => {
                    showModal("Gagal memuat gambar untuk di-upscale.", 'error');
                    loadingSection.classList.add('hidden');
                    uploadSection.classList.remove('hidden');
                };
                img.src = dataUrl;
            }

            // Pasang fungsi ke window agar bisa diakses
            window.triggerGlobalUpscale = triggerUpscaleFromDataURL;

        })();

        // === BAGIAN 6: FUNGSI COLLAPSIBLE (MINIMIZE) ===
        (function setupCollapsibles() {
            function setupToggle(toggleId, contentId, iconId, startOpen = false) {
                const toggle = document.getElementById(toggleId);
                const content = document.getElementById(contentId);
                const icon = document.getElementById(iconId);

                if (!toggle || !content || !icon) return;

                // Fungsi untuk menangani opacity dan overflow (untuk transisi yang mulus)
                const setHiddenState = (isClosed) => {
                    if (isClosed) {
                        content.classList.add('opacity-0', 'overflow-hidden');
                    } else {
                        content.classList.remove('opacity-0', 'overflow-hidden');
                    }
                };

                // Set initial state
                if (startOpen) {
                    content.style.maxHeight = content.scrollHeight + 'px';
                    icon.classList.add('rotate-180');
                    setHiddenState(false);
                } else {
                    content.style.maxHeight = '0px';
                    icon.classList.remove('rotate-180');
                    setHiddenState(true);
                }

                toggle.addEventListener('click', () => {
                    if (content.style.maxHeight === '0px') {
                        // Open it
                        setHiddenState(false); // Hapus opacity/overflow SEBELUM animasi
                        content.style.maxHeight = content.scrollHeight + 'px';
                        icon.classList.add('rotate-180');
                    } else {
                        // Close it
                        content.style.maxHeight = '0px';
                        icon.classList.remove('rotate-180');
                        // Tambah opacity/overflow SETELAH transisi selesai
                        setTimeout(() => setHiddenState(true), 500); // Harus cocok dengan durasi transisi
                    }
                });
            }

            // Step 1 starts OPEN
            setupToggle('toggle-step-1', 'content-step-1', 'toggle-icon-1', true);
            // Step 2 and 3 start CLOSED
            setupToggle('toggle-step-2', 'content-step-2', 'toggle-icon-2', false);
            setupToggle('toggle-step-3', 'content-step-3', 'toggle-icon-3', false);

        })();
        
        // === BARU: SCRIPT UNTUK APLIKASI REMIX PROMPT ===
        // --- Selektor DOM ---
        // PERBAIKAN: Deklarasikan di sini, tapi jangan inisialisasi
        let basePromptEl, remixInstructionEl, resultPromptEl, remixButton, 
            messageBox, copyButton, generateText, loadingIndicator,
            imageUploadInput, imageUploadLabel, imageUploadPlaceholder, 
            imagePreview, extractButton, extractText, extractLoading,
            readPromptButton, readPromptText, readPromptLoading,
            resetButton, sendRemixToStep3Button, sendRemixToStep2Button; // (BARU)

        // --- Variabel Status (BARU) ---
        let uploadedImage = null; // Menyimpan data gambar { data: base64, mimeType: string }

        // --- Konfigurasi API ---
        // DIHAPUS: const API_KEY_REMIX = ""; // Kunci API akan disediakan oleh lingkungan (biarkan kosong)
        // DIHAPUS: const API_URL_REMIX = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY_REMIX}`;

        // --- Logika Bahasa (DIPERBARUI) ---
        let currentLang = 'id';
        const translations = {
            'id': {
                "title": "REMIX PROMPT AILABS",
                // Panel Gambar
                "imageUploadLabel": "1. Ambil Prompt dari Gambar (Opsional)",
                "imageUploadPlaceholder": "Klik atau seret gambar ke sini",
                "imageUploadValidationError": "Harap unggah gambar terlebih dahulu.",
                // Tombol 1: Ekstrak
                "imageUploadButton": "Ekstrak Teks",
                "imageUploadLoading": "Mengekstrak...",
                "imageUploadSuccess": "Teks berhasil diekstrak! Tempelkan di bawah.",
                "imageUploadError": "Gagal mengekstrak teks.",
                // Tombol 2: Baca (BARU)
                "readPromptButton": "Buat Prompt Detail",
                "readPromptLoading": "Membaca...",
                "readPromptSuccess": "Prompt detail berhasil dibuat!",
                "readPromptError": "Gagal membuat prompt detail.",
                // Panel Lainnya
                "basePromptLabel": "2. Prompt Dasar",
                "remixInstructionLabel": "3. Perintah Remix",
                "resultPromptLabel": "4. Hasil Remix",
                "remixButton": "Remix Prompt",
                "resetButton": "Reset", // BARU
                "loadingText": "Memproses...",
                "copyButton": "Salin",
                "copyButtonSuccess": "Tersalin!",
                "useAsBaseButton": "Gunakan",
                "placeholderBase": "Masukkan prompt dasar Anda di sini...\n\nContoh:\nSeekor kucing oranye gemuk sedang tidur di atas tumpukan buku.",
                "placeholderRemix": "Apa yang ingin Anda ubah?\n\nContoh:\nUbah menjadi gaya sinematik, pencahayaan dramatis, dan tambahkan suasana hujan di luar jendela.",
                "placeholderResult": "Hasil prompt yang di-remix akan muncul di sini...",
                "validationError": "Harap isi Prompt Dasar dan Perintah Remix.",
                "loadingAI": "Sedang menghubungi AI untuk me-remix prompt Anda... ??",
                "errorAPI": "Respon API tidak valid atau kosong.",
                "errorGeneral": "Gagal me-remix prompt. Silakan coba lagi beberapa saat.",
                "errorGeneralShort": "Terjadi kesalahan. Coba lagi.",
                "movedToBasetoast": "Hasil dipindahkan ke Prompt Dasar. Masukkan perintah baru."
            },
            'en': {
                "title": "REMIX PROMPT AILABS",
                // Panel Gambar
                "imageUploadLabel": "1. Get Prompt from Image (Optional)",
                "imageUploadPlaceholder": "Click or drag image here",
                "imageUploadValidationError": "Please upload an image first.",
                // Tombol 1: Ekstrak
                "imageUploadButton": "Extract Text",
                "imageUploadLoading": "Extracting...",
                "imageUploadSuccess": "Text extracted successfully! Paste below.",
                "imageUploadError": "Failed to extract text.",
                // Tombol 2: Baca (BARU)
                "readPromptButton": "Create Detailed Prompt",
                "readPromptLoading": "Reading...",
                "readPromptSuccess": "Detailed prompt created!",
                "readPromptError": "Failed to create detailed prompt.",
                // Panel Lainnya
                "basePromptLabel": "2. Base Prompt",
                "remixInstructionLabel": "3. Remix Instruction",
                "resultPromptLabel": "4. Remixed Result",
                "remixButton": "Remix Prompt",
                "resetButton": "Reset", // BARU
                "loadingText": "Processing...",
                "copyButton": "Copy",
                "copyButtonSuccess": "Copied!",
                "useAsBaseButton": "Use",
                "placeholderBase": "Enter your base prompt here...\n\nExample:\nA fat orange cat sleeping on a pile of books.",
                "placeholderRemix": "What do you want to change?\n\nExample:\nChange to a cinematic style, dramatic lighting, and add rain outside the window.",
                "placeholderResult": "The remixed prompt result will appear here...",
                "validationError": "Please fill in the Base Prompt and Remix Instruction.",
                "loadingAI": "Contacting AI to remix your prompt... ??",
                "errorAPI": "Invalid or empty API response.",
                "errorGeneral": "Failed to remix prompt. Please try again later.",
                "errorGeneralShort": "An error occurred. Try again.",
                "movedToBasetoast": "Result moved to Base Prompt. Enter a new instruction."
            }
        };

        /**
         * Mengatur bahasa UI
         * @param {string} lang - 'id' atau 'en'
         */
        window.setLanguage = function(lang) {
            currentLang = lang;
            const strings = translations[lang];

            // Memperbarui semua elemen dengan data-key
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.dataset.key;
                if (strings[key]) {
                    // Jaga ikon tetap utuh
                    const icon = el.querySelector('i');
                    if (icon || el.querySelector('svg')) { // Cek <i> atau <svg>
                        const textNode = Array.from(el.childNodes).find(node => node.nodeType === Node.TEXT_NODE);
                        if (textNode) {
                            textNode.textContent = ` ${strings[key]} `;
                        } else {
                            // Jika tidak ada node teks (misalnya, baru dimuat), tambahkan satu
                            const spanElement = el.querySelector('span[data-key]'); // Cari span di dalam tombol
                            if (spanElement) {
                                spanElement.textContent = strings[key];
                            } else if(el.dataset.key === "copyButton") { // Khusus tombol salin
                                // Ini mungkin perlu disesuaikan jika tombol salin Anda memiliki ikon
                                const copyIcon = el.querySelector('i') ? el.querySelector('i').outerHTML : '';
                                el.innerHTML = copyIcon + ' ' + strings[key];
                            }
                        }
                    } else {
                         el.textContent = strings[key];
                    }
                }
            });

            // Memperbarui placeholder
            if (basePromptEl) basePromptEl.placeholder = strings.placeholderBase;
            if (remixInstructionEl) remixInstructionEl.placeholder = strings.placeholderRemix;
            if (resultPromptEl) resultPromptEl.placeholder = strings.placeholderResult;
            
            if (imageUploadPlaceholder) { // Cek jika elemen ada
                const placeholderSpan = imageUploadPlaceholder.querySelector('span[data-key="imageUploadPlaceholder"]');
                if (placeholderSpan && !uploadedImage) { // Hanya update jika tidak ada gambar
                    placeholderSpan.textContent = strings.imageUploadPlaceholder;
                }
            }

            // Memperbarui gaya tombol bahasa
            const langIdBtn = document.getElementById('lang-id');
            const langEnBtn = document.getElementById('lang-en');
            if (lang === 'id') {
                if(langIdBtn) {
                    langIdBtn.classList.replace('text-gray-400', 'text-white');
                    langIdBtn.classList.replace('opacity-70', 'opacity-100');
                    langIdBtn.classList.add('font-bold');
                }
                if(langEnBtn) {
                    langEnBtn.classList.replace('text-white', 'text-gray-400');
                    langEnBtn.classList.replace('opacity-100', 'opacity-70');
                    langEnBtn.classList.remove('font-bold');
                }
            } else {
                if(langEnBtn) {
                    langEnBtn.classList.replace('text-gray-400', 'text-white');
                    langEnBtn.classList.replace('opacity-70', 'opacity-100');
                    langEnBtn.classList.add('font-bold');
                }
                if(langIdBtn) {
                    langIdBtn.classList.replace('text-white', 'text-gray-400');
                    langIdBtn.classList.replace('opacity-100', 'opacity-70');
                    langIdBtn.classList.remove('font-bold');
                }
            }

            // Set ulang teks tombol salin jika sedang dalam keadaan "Tersalin!"
            if(copyButton) { 
                const copyBtnSpan = copyButton.querySelector('span[data-key="copyButton"]');
                if (copyBtnSpan && (copyBtnSpan.textContent === translations.id.copyButtonSuccess || copyBtnSpan.textContent === translations.en.copyButtonSuccess)) {
                    copyBtnSpan.textContent = strings.copyButton;
                    const copyIconWrapper = document.getElementById('copyIconWrapper');
                    if(copyIconWrapper) { // Cek null
                        copyIconWrapper.innerHTML = '<i data-lucide="copy" class="w-4 h-4"></i>';
                        if(typeof lucide !== 'undefined') lucide.createIcons({ nodes: [copyIconWrapper.querySelector('i')] });
                    }
                    copyButton.disabled = false;
                }
            }
        }

        // --- FUNGSI UTILITAS ---
        /**
         * Mengubah ArrayBuffer menjadi string Base64.
         * @param {ArrayBuffer} buffer - Buffer data gambar.
         * @returns {string} - String Base64.
         */
        function arrayBufferToBase64(buffer) {
            let binary = '';
            const bytes = new Uint8Array(buffer);
            const len = bytes.byteLength;
            for (let i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }

        // --- FUNGSI RESET (BARU) ---
        /**
         * Mengatur ulang seluruh state aplikasi ke awal.
         */
        window.resetApp = function() {
            if(!imageUploadInput) return; // Belum siap
            // 1. Reset input file dan gambar
            imageUploadInput.value = ''; // Hapus file yang dipilih
            uploadedImage = null;
            imagePreview.classList.add('hidden'); // Sembunyikan pratinjau
            imagePreview.src = ''; // Hapus src
            imageUploadPlaceholder.classList.remove('hidden'); // Tampilkan placeholder
            
            // 2. Reset semua textarea
            basePromptEl.value = '';
            remixInstructionEl.value = '';
            resultPromptEl.value = '';
            
            // 3. Hapus pesan error/sukses
            messageBox.textContent = '';
            
            // 4. Setel ulang bahasa (untuk placeholder)
            setLanguage(currentLang);
            
            // 5. Gulir ke atas
            const remixAppContainer = document.getElementById('remix-app-container');
            if(remixAppContainer) remixAppContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // --- FUNGSI GAMBAR ---
        /**
         * Menangani upload gambar, membaca file, dan menampilkan pratinjau.
         * @param {Event} event - Event dari input file.
         */
        window.handleImageUpload = function(event) {
            const file = event.target.files[0];
            if (!file) {
                uploadedImage = null;
                if(imagePreview) imagePreview.classList.add('hidden');
                if(imageUploadPlaceholder) imageUploadPlaceholder.classList.remove('hidden');
                return;
            }

            const mimeType = file.type;
            const reader = new FileReader();

            reader.onload = (e) => {
                const base64Data = arrayBufferToBase64(e.target.result);
                uploadedImage = { data: base64Data, mimeType: mimeType };
                
                // Tampilkan pratinjau
                if(imagePreview) {
                    imagePreview.src = `data:${mimeType};base64,${base64Data}`;
                    imagePreview.classList.remove('hidden');
                }
                if(imageUploadPlaceholder) imageUploadPlaceholder.classList.add('hidden');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        /**
         * Helper untuk mengatur status loading tombol gambar (BARU)
         * @param {boolean} isLoading - Apakah sedang loading?
         * @param {string|null} activeButton - 'extract' atau 'read'
         */
        function setButtonLoadingState(isLoading, activeButton = null) {
            if(!extractButton || !readPromptButton) return; // Belum siap

            if (isLoading) {
                extractButton.disabled = true;
                readPromptButton.disabled = true; // Nonaktifkan kedua tombol

                if (activeButton === 'extract') {
                    extractButton.classList.add('loading-animation-orange');
                    if(extractText) extractText.classList.add('hidden');
                    if(extractLoading) extractLoading.classList.remove('hidden');
                } else if (activeButton === 'read') {
                    readPromptButton.classList.add('loading-animation'); // Animasi cyan
                    if(readPromptText) readPromptText.classList.add('hidden');
                    if(readPromptLoading) readPromptLoading.classList.remove('hidden');
                }
            } else {
                extractButton.disabled = false;
                readPromptButton.disabled = false; // Aktifkan kedua tombol

                // Reset tombol Ekstrak
                extractButton.classList.remove('loading-animation-orange');
                if(extractText) extractText.classList.remove('hidden');
                if(extractLoading) extractLoading.classList.add('hidden');
                
                // Reset tombol Baca
                readPromptButton.classList.remove('loading-animation');
                if(readPromptText) readPromptText.classList.remove('hidden');
                if(readPromptLoading) readPromptLoading.classList.add('hidden');
            }
        }


        /**
         * Menangani klik tombol "Ekstrak Teks" (DIPERBARUI)
         */
        async function handleExtractText() {
            if(!messageBox) return; // Belum siap
            messageBox.textContent = ''; // Hapus pesan lama
            if (!uploadedImage) {
                messageBox.textContent = translations[currentLang].imageUploadValidationError;
                return;
            }

            // Atur status loading
            setButtonLoadingState(true, 'extract');

            const payload = {
                contents: [
                    {
                        role: "user",
                        parts: [
                            { text: "Ekstrak semua teks yang terlihat dari gambar ini. Hanya kembalikan teks mentah." },
                            {
                                inlineData: {
                                    mimeType: uploadedImage.mimeType,
                                    data: uploadedImage.data
                                }
                            }
                        ]
                    }
                ],
            };

            try {
                const model = 'gemini-2.5-flash-preview-09-2025'; // BARU
                const result = await callGeminiWithRetry(model, payload, 3, 1000);
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    if(basePromptEl) basePromptEl.value = text.trim(); // Masukkan ke Prompt Dasar
                    
                    // Tampilkan pesan sukses di messageBox
                    messageBox.classList.remove('text-red-400');
                    messageBox.classList.add('text-cyan-400');
                    messageBox.textContent = translations[currentLang].imageUploadSuccess;
                    
                    setTimeout(() => { 
                        messageBox.textContent = '';
                        messageBox.classList.remove('text-cyan-400');
                        messageBox.classList.add('text-red-400');
                    }, 3000);

                } else {
                    throw new Error(translations[currentLang].errorAPI);
                }
            } catch (error) {
                console.error('Error saat mengekstrak teks:', error);
                messageBox.textContent = translations[currentLang].imageUploadError;
            } finally {
                // Kembalikan status tombol
                setButtonLoadingState(false);
            }
        }
        
        /**
         * Menangani klik tombol "Buat Prompt Detail" (BARU).
         */
        async function handleReadPrompt() {
            if(!messageBox) return; // Belum siap
            messageBox.textContent = '';
            if (!uploadedImage) {
                messageBox.textContent = translations[currentLang].imageUploadValidationError;
                return;
            }

            // Atur status loading
            setButtonLoadingState(true, 'read'); 

            const payload = {
                contents: [
                    {
                        role: "user",
                        parts: [
                            // PROMPT SISTEM BARU
                            { text: "Anda adalah seorang prompt engineer ahli. Lihat gambar ini dan buatkan prompt deskriptif yang detail. Fokus pada subjek utama, latar belakang, pencahayaan, gaya, dan komposisi. Hanya kembalikan prompt yang sudah jadi." },
                            {
                                inlineData: {
                                    mimeType: uploadedImage.mimeType,
                                    data: uploadedImage.data
                                }
                            }
                        ]
                    }
                ],
                 generationConfig: {
                    temperature: 0.5, // Sedikit kreatif
                    topP: 1,
                    topK: 1
                }
            };

            try {
                const model = 'gemini-2.5-flash-preview-09-2025'; // BARU
                const result = await callGeminiWithRetry(model, payload, 3, 1000);
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    if(basePromptEl) basePromptEl.value = text.trim(); // Masukkan ke Prompt Dasar
                    
                    messageBox.classList.remove('text-red-400');
                    messageBox.classList.add('text-cyan-400');
                    messageBox.textContent = translations[currentLang].readPromptSuccess; // Pesan sukses baru
                    
                    setTimeout(() => { 
                        messageBox.textContent = '';
                        messageBox.classList.remove('text-cyan-400');
                        messageBox.classList.add('text-red-400');
                    }, 3000);

                } else {
                    throw new Error(translations[currentLang].errorAPI);
                }
            } catch (error) {
                console.error('Error saat membuat prompt detail:', error);
                messageBox.textContent = translations[currentLang].readPromptError; // Pesan error baru
            } finally {
                // Kembalikan status tombol
                setButtonLoadingState(false);
            }
        }


        // --- FUNGSI REMIX YANG ADA ---
        /**
         * Menyalin teks ke clipboard
         */
        window.copyToClipboard = function() {
            if(!resultPromptEl) return; // Belum siap
            const textToCopy = resultPromptEl.value;
            if (!textToCopy) return;

            // Metode fallback untuk iframe
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            tempTextArea.style.position = 'absolute';
            tempTextArea.style.left = '-9999px';
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            // Umpan balik visual
            const copyBtnSpan = copyButton.querySelector('span[data-key="copyButton"]');
            const copyIconWrapper = document.getElementById('copyIconWrapper'); 
            
            if(copyBtnSpan) copyBtnSpan.textContent = translations[currentLang].copyButtonSuccess;
            
            if(copyIconWrapper) {
                copyIconWrapper.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i>';
                if(typeof lucide !== 'undefined') lucide.createIcons({ nodes: [copyIconWrapper.querySelector('i')] });
            }
            
            copyButton.disabled = true;

            setTimeout(() => {
                if(copyBtnSpan) copyBtnSpan.textContent = translations[currentLang].copyButton;
                
                if(copyIconWrapper) {
                    copyIconWrapper.innerHTML = '<i data-lucide="copy" class="w-4 h-4"></i>';
                    if(typeof lucide !== 'undefined') lucide.createIcons({ nodes: [copyIconWrapper.querySelector('i')] });
                }

                copyButton.disabled = false;
            }, 2000);
        }

        /**
         * Mengirim hasil kembali ke prompt dasar
         */
        window.useResultAsBase = function() {
            if(!resultPromptEl) return; // Belum siap
            const textToUse = resultPromptEl.value;
            if (!textToUse || textToUse.startsWith(translations[currentLang].loadingAI.substring(0, 10))) {
                return; 
            }

            basePromptEl.value = textToUse;
            remixInstructionEl.value = '';
            resultPromptEl.value = '';

            messageBox.classList.remove('text-red-400');
            messageBox.classList.add('text-cyan-400'); 
            messageBox.textContent = translations[currentLang].movedToBasetoast;
            
            setTimeout(() => { 
                messageBox.textContent = '';
                messageBox.classList.remove('text-cyan-400');
                messageBox.classList.add('text-red-400'); 
            }, 3000);

            remixInstructionEl.focus(); 
        }

        /**
         * Menangani klik tombol Remix.
         */
        async function handleRemix() {
            if(!basePromptEl) return; // Belum siap
            
            const basePrompt = basePromptEl.value.trim();
            const remixInstruction = remixInstructionEl.value.trim();
            messageBox.textContent = ''; 

            if (!basePrompt || !remixInstruction) {
                messageBox.textContent = translations[currentLang].validationError;
                return;
            }

            remixButton.disabled = true;
            remixButton.classList.add('loading-animation'); 
            generateText.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            resultPromptEl.value = translations[currentLang].loadingAI; 

            const systemPrompt = `Anda adalah asisten ahli remix prompt. Ambil [PROMPT DASAR] dan ubah sesuai dengan [PERINTAH REMIX]. 
Tugas Anda adalah mengeluarkan HANYA prompt baru yang sudah di-remix. 
Jangan tambahkan teks, penjelasan, 'Tentu, ini hasilnya:', atau sapaan lain. 
Pastikan output Anda murni hanya prompt yang sudah jadi dan siap digunakan.`;
            
            const userQuery = `[PROMPT DASAR]:\n${basePrompt}\n\n[PERINTAH REMIX]:\n${remixInstruction}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                generationConfig: {
                    temperature: 0.7,
                    topP: 1,
                    topK: 1
                }
            };

            try {
                const model = 'gemini-2.5-flash-preview-09-2025'; // BARU
                const result = await callGeminiWithRetry(model, payload, 3, 1000); // Gunakan URL unik
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    resultPromptEl.value = text.trim();
                } else {
                    throw new Error(translations[currentLang].errorAPI); 
                }
            } catch (error) {
                console.error('Error saat me-remix prompt:', error);
                resultPromptEl.value = translations[currentLang].errorGeneral; 
                messageBox.textContent = translations[currentLang].errorGeneralShort; 
            } finally {
                remixButton.disabled = false;
                remixButton.classList.remove('loading-animation');
                generateText.classList.remove('hidden');
                loadingIndicator.classList.add('hidden');
            }
        }

        /**
         * Fungsi untuk memanggil API dengan logika exponential backoff sederhana.
         * @param {object} payload - Body permintaan untuk API.
         * @param {number} retries - Jumlah maksimum percobaan ulang.
         * @param {number} delay - Waktu tunda awal dalam milidetik.
         * @param {string} apiUrl - URL API yang akan dipanggil (untuk menghindari konflik)
         * @returns {Promise<object>} - Hasil JSON dari API.
         */
        async function callGeminiWithRetry(model, payload, retries = 3, delay = 1000) {
            const proxyUrl = '/api/proxy.js'; // BARU: Selalu panggil proxy
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(proxyUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        // BARU: Kirim model dan payload ke proxy
                        body: JSON.stringify({ model: model, payload: payload })
                    });

                    if (!response.ok) {
                        if (response.status >= 500 && response.status < 600) {
                             throw new Error(`Server error: ${response.status}`);
                        } else {
                            // Coba dapatkan pesan error dari body
                            let errorData;
                            try {
                                errorData = await response.json();
                            } catch (e) {
                                // Gagal parse json, gunakan text
                                errorData = await response.text();
                            }
                            console.error("Client error:", errorData);
                            // Cek jika error karena safety
                            if (errorData?.error?.message?.includes('SAFETY')) {
                                 throw new Error('Permintaan diblokir karena alasan keamanan. Coba gambar atau prompt lain.');
                            }
                            throw new Error(`Client error: ${response.status}`);
                        }
                    }
                    const data = await response.json();
                    
                    const candidate = data.candidates?.[0];
                    // Periksa jika finishReason adalah SAFETY
                    if (candidate && candidate.finishReason === 'SAFETY') {
                        throw new Error('Permintaan diblokir karena alasan keamanan. Coba gambar atau prompt lain.');
                    }
                    
                    if (!candidate || !candidate.content) {
                         throw new Error('Respon API tidak lengkap atau kosong.');
                    }

                    return data; // Sukses
                } catch (error) {
                    if (i === retries - 1) { // Jika ini percobaan terakhir, lempar error
                        console.error('Error akhir setelah retries:', error);
                        // Tampilkan error ke pengguna
                        if(messageBox) messageBox.textContent = error.message;
                        throw error;
                    }
                    // Tunggu sebelum mencoba lagi
                    await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));
                }
            }
        }

        // Inisialisasi Ikon saat memuat
        // Menggunakan event listener untuk memastikan DOM dimuat, BUKAN window.onload
        document.addEventListener('DOMContentLoaded', (event) => {
            // Inisialisasi semua elemen DOM di sini
            basePromptEl = document.getElementById('basePrompt');
            remixInstructionEl = document.getElementById('remixInstruction');
            resultPromptEl = document.getElementById('resultPrompt');
            remixButton = document.getElementById('remixButton');
            messageBox = document.getElementById('messageBox');
            copyButton = document.getElementById('copyButton');
            generateText = document.getElementById('generateText');
            loadingIndicator = document.getElementById('loadingIndicator');
            
            // Inisialisasi elemen gambar
            imageUploadInput = document.getElementById('imageUpload');
            imageUploadLabel = document.getElementById('imageUploadLabel');
            imageUploadPlaceholder = document.getElementById('imageUploadPlaceholder');
            imagePreview = document.getElementById('imagePreview');
            extractButton = document.getElementById('extractButton');
            extractText = document.getElementById('extractText');
            extractLoading = document.getElementById('extractLoading');
            // BARU
            readPromptButton = document.getElementById('readPromptButton');
            readPromptText = document.getElementById('readPromptText');
            readPromptLoading = document.getElementById('readPromptLoading');
            // BARU (RESET)
            resetButton = document.getElementById('resetButton');
            // BARU (KIRIM KE STEP 3)
            sendRemixToStep3Button = document.getElementById('send-remix-to-step-3');
            // BARU (KIRIM KE STEP 2)
            sendRemixToStep2Button = document.getElementById('send-remix-to-step-2');


            // Tambahkan event listener di sini
            if(remixButton) remixButton.addEventListener('click', handleRemix);
            if(extractButton) extractButton.addEventListener('click', handleExtractText); 
            if(readPromptButton) readPromptButton.addEventListener('click', handleReadPrompt); // BARU
            if(resetButton) resetButton.addEventListener('click', window.resetApp); // BARU
            
            // BARU: Event listener untuk Kirim ke Ciptakan Gambar
            if(sendRemixToStep3Button) {
                sendRemixToStep3Button.addEventListener('click', () => {
                    const step3Input = document.getElementById('prompt-input-3');
                    const step3Section = document.getElementById('step-3');
                    const remixResult = document.getElementById('resultPrompt');

                    if (!remixResult || !remixResult.value) {
                        showModal("Hasil remix masih kosong. Buat remix terlebih dahulu.", 'error');
                        return;
                    }
                    
                    if (step3Input && step3Section) {
                        step3Input.value = remixResult.value;
                        step3Section.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        showModal("Prompt remix dikirim ke Ciptakan Gambar!", 'success');
                    } else {
                        console.error("Elemen 'prompt-input-3' or 'step-3' tidak ditemukan.");
                        showModal("Error: Tidak dapat menemukan target aplikasi 'Ciptakan Gambar'.", 'error');
                    }
                });
            }

            // BARU: Event listener untuk Kirim ke Sempurnakan (Langkah 2)
            if(sendRemixToStep2Button) {
                sendRemixToStep2Button.addEventListener('click', () => {
                    const step2Input = document.getElementById('prompt-input-2');
                    const step2Section = document.getElementById('step-2');
                    const remixResult = document.getElementById('resultPrompt');

                    if (!remixResult || !remixResult.value) {
                        showModal("Hasil remix masih kosong. Buat remix terlebih dahulu.", 'error');
                        return;
                    }
                    
                    if (step2Input && step2Section) {
                        step2Input.value = remixResult.value;
                        step2Section.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        showModal("Prompt remix dikirim ke Sempurnakan (Langkah 2)!", 'success');
                    } else {
                        console.error("Elemen 'prompt-input-2' or 'step-2' tidak ditemukan.");
                        showModal("Error: Tidak dapat menemukan target aplikasi 'Sempurnakan'.", 'error');
                    }
                });
            }

            // Event listener untuk drag and drop
            if(imageUploadLabel) {
                imageUploadLabel.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    imageUploadLabel.classList.add('dragover');
                });
                imageUploadLabel.addEventListener('dragleave', () => {
                    imageUploadLabel.classList.remove('dragover');
                });
                imageUploadLabel.addEventListener('drop', (e) => {
                    e.preventDefault();
                    imageUploadLabel.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        imageUploadInput.files = files; // Masukkan file ke input
                        handleImageUpload({ target: imageUploadInput }); // Panggil handler
                    }
                });
            }


            // Sekarang aman untuk memanggil setLanguage
            setLanguage(currentLang); 
            if(typeof lucide !== 'undefined') { // Cek jika lucide sudah dimuat
                lucide.createIcons();
            }
        });
        // === AKHIR SCRIPT REMIX PROMPT ===

    </script>
    
    <!-- === SCRIPT UNTUK APLIKASI POSE (BARU) === -->
    <script type="module">
        // --- Referensi DOM ---
        const uploadInput = document.getElementById('image-upload');
        const previewImg = document.getElementById('preview');
        const watermarkToggle = document.getElementById('watermark-toggle');
        const watermarkText = document.getElementById('watermark-text');
        const generateBtn = document.getElementById('generate-btn');
        const loader = document.getElementById('loader');
        const resultsContainer = document.getElementById('results-container');
        const errorMessage = document.getElementById('error-message');

        // --- State Aplikasi ---
        let uploadedBase64 = null;
        let isGenerating = false;

        // --- Konfigurasi API ---
        // DIHAPUS: const apiKey = ""; // Biarkan kosong, akan diisi oleh Canvas
        // DIHAPUS: const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
        const proxyUrl = '/api/proxy.js'; // BARU: Panggil proxy Vercel

        // === FUNGSI SINKRONISASI BARU ===
        // --- Fungsi Publik untuk Menerima Gambar dari Langkah 3 ---
        function triggerGlobalPoseFromDataURL(dataUrl) {
            if (!previewImg) return;
            
            // 1. Set gambar preview
            previewImg.src = dataUrl;
            
            // 2. Set base64 internal
            try {
                uploadedBase64 = dataUrl.split(',')[1];
                showError(""); // Hapus error jika ada
            } catch (e) {
                console.error("Gagal mem-parsing data URL:", e);
                showError("Gagal memuat gambar dari AI Labs.");
                uploadedBase64 = null;
            }
            
            // 3. Hapus file input (jika ada)
            if (uploadInput) uploadInput.value = '';
        }

        // Pasang fungsi ke window agar bisa diakses
        window.triggerGlobalPose = triggerGlobalPoseFromDataURL;
        // === AKHIR FUNGSI SINKRONISASI ===


        // --- Daftar Prompt Acak (FOKUS PADA POSE BERVARIASI, DINAMIS, DAN CERDAS) ---
        const allPrompts = [
            // POSE DINAMIS & ENERGIK
            { 
                id: 1, 
                text: "Potret orang ini, hyper-realistic, berpose dengan sedikit condong ke depan, tangan menunjuk ke kejauhan, ekspresi antusias, 100% wajah asli.",
                caption: "Masa depan ada di depan! Pose berenergi dan optimis. ?? #DynamicPose #Optimistic #LookingAhead #FYP"
            },
            { 
                id: 2, 
                text: "Potret orang ini, hyper-realistic, tangan diangkat tinggi-tinggi dalam gestur perayaan atau kemenangan, senyum lebar, 100% wajah asli.",
                caption: "Pencapaian hari ini! Rasakan energi kemenangannya. ?? #VictoryPose #Celebration #HighEnergy #FYP"
            },
            { 
                id: 3, 
                text: "Potret orang ini, hyper-realistic, melirik ke belakang bahu dengan ekspresi misterius atau bermain-main (playful), 100% wajah asli. Latar belakang blur ringan.",
                caption: "Ada rahasia di balik lirikanku. ?? Pose playful yang bikin penasaran! #PlayfulPose #MysteriousVibes #BehindTheShoulder #FYP"
            },
            
            // POSE BERKELAS & FOKUS
            { 
                id: 4, 
                text: "Potret orang ini, hyper-realistic, berpose menyentuh kacamata (jika ada) atau mengusap dagu, tatapan tajam dan fokus, 100% wajah asli. Pencahayaan studio.",
                caption: "Mode fokus: ON. Ekspresi cerdas dan penuh strategi. ?? #Focused #IntelligentPose #SharpLook #FYP"
            },
            { 
                id: 5, 
                text: "Potret orang ini, hyper-realistic, tangan memegang pena atau alat tulis, terlihat sedang menulis atau membuat catatan dengan ekspresi serius, 100% wajah asli.",
                caption: "Mencatat setiap ide berharga. Pose cerdas dan produktif. ?? #ProductivePose #Intellectual #DeepWork #FYP"
            },
            { 
                id: 6, 
                text: "Potret orang ini, hyper-realistic, sedang bertelepon (gestur tangan mendekat ke telinga) dengan ekspresi mendengar yang intens, 100% wajah asli.",
                caption: "Komunikasi intens. Mendengarkan dengan penuh perhatian. ?? #Communication #IntenseLook #BusinessVibes #FYP"
            },

            // POSE SANTAI TAPI ELEGAN
            { 
                id: 7, 
                text: "Potret orang ini, hyper-realistic, duduk di kursi berlengan dengan satu kaki terlipat, pose santai namun elegan, 100% wajah asli. Pencahayaan lembut.",
                caption: "Elegansi dalam kenyamanan. Pose santai yang berkelas. ? #ElegantPose #RelaxedButClassy #Lounging #FYP"
            },
            { 
                id: 8, 
                text: "Potret orang ini, hyper-realistic, tangan memegang kerah baju atau jaket, tatapan menenangkan, 100% wajah asli. Komposisi portrait.",
                caption: "Gestur kecil dengan dampak besar. Tenang dan menawan. ? #CharmingPose #SoftGaze #PortraitGoals #FYP"
            },
            { 
                id: 9, 
                text: "Potret orang ini, hyper-realistic, pose 'hands in hair' atau merapikan rambut, ekspresi kasual dan santai, 100% wajah asli.",
                caption: "Sedikit sentuhan natural. Merapikan diri, siap bersinar. ????? #HandsInHair #CasualStyle #NaturalBeauty #FYP"
            },

            // POSE SIFAT DAN EMOSI
            { 
                id: 10, 
                text: "Potret orang ini, hyper-realistic, mata tertutup, ekspresi damai dan penuh kedamaian (serene), 100% wajah asli. Latar belakang sangat blur.",
                caption: "Mencari ketenangan dalam diri. Kedamaian sejati. ?? #Serene #PeacefulMind #InnerPeace #FYP"
            },
            { 
                id: 11, 
                text: "Potret orang ini, hyper-realistic, berpose tertawa lepas dengan kepala sedikit miring, ekspresi bahagia yang menular, 100% wajah asli.",
                caption: "Tertawa tanpa beban! Momen bahagia yang nggak bisa dibeli. ?? #GenuineLaugh #HappyVibes #ContagiousJoy #FYP"
            },
            { 
                id: 12, 
                text: "Potret orang ini, hyper-realistic, ekspresi wajah sedikit sinis atau curiga dengan alis terangkat, 100% wajah asli.",
                caption: "Hmm... ada yang mencurigakan. Ekspresi sinis yang bikin penasaran. ?? #Skeptical #Curiousity #Intrigue #FYP"
            },

            // POSE GESTUR & SILUET
            { 
                id: 13, 
                text: "Potret orang ini, hyper-realistic, tangan di depan wajah dalam gestur 'stop' atau 'wait', ekspresi tegas, 100% wajah asli.",
                caption: "Tahan dulu! Pesan tegas dalam sebuah pose. ? #StopPose #Assertive #HoldOn #FYP"
            },
            { 
                id: 14, 
                text: "Potret orang ini, hyper-realistic, menunjukkan 'peace sign' atau 'V sign' dengan tangan, ekspresi ramah, 100% wajah asli.",
                caption: "Peace and love! Spread the good vibes. ?? #PeaceSign #FriendlyVibes #GoodMood #FYP"
            },
            { 
                id: 15, 
                text: "Potret orang ini, hyper-realistic, siluet dramatis dengan cahaya belakang yang kuat, fokus pada bentuk kepala dan bahu, 100% wajah asli.",
                caption: "Siluet yang bercerita. Fokus pada kontur dan bentuk. ?? #Silhouette #DramaticLight #ArtisticShot #FYP"
            }
        ];

        // --- Fungsi Bantuan ---
        function getRandomPrompts(promptList, count) {
            const shuffled = [...promptList].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // --- Logika Upload Gambar ---
        uploadInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
                showError("Format file tidak didukung. Harap unggah JPEG, PNG, atau WebP.");
                return;
            }
            const reader = new FileReader();
            reader.onload = (event) => {
                previewImg.src = event.target.result;
                uploadedBase64 = event.target.result.split(',')[1];
                showError(""); 
            };
            reader.readAsDataURL(file);
        });

        // --- Tombol Generate Utama ---
        generateBtn.addEventListener('click', async () => {
            if (!uploadedBase64) {
                showError("Harap unggah gambar wajah Anda terlebih dahulu.");
                return;
            }
            if (isGenerating) return; 

            isGenerating = true;
            loader.style.display = 'flex';
            resultsContainer.innerHTML = '';
            showError("");
            generateBtn.disabled = true;
            generateBtn.textContent = "Sedang Menghasilkan...";

            const promptsToUse = getRandomPrompts(allPrompts, 3);
            const customWatermarkText = watermarkText.value;

            try {
                const generationPromises = promptsToUse.map(p => 
                    callGeminiApi(p.text, uploadedBase64)
                        .then(base64Data => ({ ...p, base64Data }))
                        .catch(err => ({ ...p, error: err }))
                );
                
                const results = await Promise.all(generationPromises);

                for (const result of results) {
                    if (result.base64Data) {
                        let finalImageData = `data:image/png;base64,${result.base64Data}`;
                        
                        if (watermarkToggle.checked && customWatermarkText) {
                            finalImageData = await applyWatermark(finalImageData, customWatermarkText);
                        }
                        
                        createImageCard(finalImageData, result.text, result.caption);
                    } else {
                        createErrorCard(result.text);
                        console.error(`Gagal menghasilkan untuk prompt: ${result.text}`, result.error);
                    }
                }

            } catch (error) {
                console.error("Terjadi kesalahan saat generasi:", error);
                showError("Terjadi kesalahan. Silakan coba lagi.");
            } finally {
                isGenerating = false;
                loader.style.display = 'none';
                generateBtn.disabled = false;
                generateBtn.textContent = "Hasilkan 3 Pose Acak";
            }
        });

        // --- Fungsi Panggilan API (Image-to-Image) ---
        async function callGeminiApi(prompt, base64Data) {
            let attempt = 0;
            const maxAttempts = 5;
            let delay = 1000;

            while (attempt < maxAttempts) {
                try {
                    const model = 'gemini-2.5-flash-image-preview'; // BARU
                    const payload = {
                        contents: [{
                            parts: [
                                { text: prompt },
                                {
                                    inlineData: {
                                        mimeType: "image/jpeg", 
                                        data: base64Data
                                    }
                                }
                            ]
                        }],
                    };

                    const response = await fetch(proxyUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        // BARU: Kirim model dan payload ke proxy
                        body: JSON.stringify({ model: model, payload: payload })
                    });

                    if (!response.ok) {
                        if (response.status === 429 || response.status >= 500) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        } else {
                            const errorData = await response.json();
                            console.error("API Error (Non-retryable):", errorData);
                            throw new Error(`API Error: ${errorData.error?.message || 'Permintaan gagal'}`);
                        }
                    }

                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData);
                    
                    if (part && part.inlineData?.data) {
                        return part.inlineData.data; 
                    } else {
                        console.warn("Respon API tidak mengandung data gambar:", result);
                        throw new Error("Respon API tidak valid.");
                    }

                } catch (error) {
                    console.warn(`Upaya ${attempt + 1} gagal:`, error.message);
                    attempt++;
                    if (attempt >= maxAttempts) {
                        throw error; 
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; 
                }
            }
        }

        // --- Fungsi Terapkan Watermark ---
        function applyWatermark(base64ImageData, text) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    ctx.drawImage(img, 0, 0);
                    
                    const fontSize = Math.max(canvas.width / 25, 20); 
                    ctx.font = `600 ${fontSize}px Inter, sans-serif`; 
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)'; 
                    
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
                    ctx.shadowBlur = 4;
                    ctx.shadowOffsetX = 1;
                    ctx.shadowOffsetY = 1;

                    ctx.textAlign = 'right';
                    ctx.textBaseline = 'bottom';
                    const margin = canvas.width * 0.03; 
                    
                    ctx.fillText(text, canvas.width - margin, canvas.height - margin);
                    
                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = () => {
                    resolve(base64ImageData); 
                };
                img.src = base64ImageData;
            });
        }

        // --- Fungsi Buat Kartu Hasil (DIPERBARUI DENGAN TOMBOL SALIN RAPI) ---
        function createImageCard(imageDataUrl, promptText, captionText) {
            const card = document.createElement('div');
            // MODIFIKASI: Menggunakan glass-card agar sesuai tema
            card.className = 'relative glass-card p-3 space-y-3 rounded-lg';
            card.setAttribute('data-prompt', promptText); 
            card.setAttribute('data-caption', captionText);

            const img = document.createElement('img');
            img.src = imageDataUrl;
            img.alt = "Gambar hasil AI";
            img.className = 'w-full h-auto object-cover rounded-lg aspect-square';
            
            // Kontainer untuk caption dan tombol salin
            const captionContainer = document.createElement('div');
            // MODIFIKASI: Latar belakang lebih gelap agar kontras dengan glass-card
            captionContainer.className = 'bg-gray-900/50 p-2 rounded-md flex items-start justify-between gap-2';

            // Teks caption
            const captionTextElement = document.createElement('p');
            captionTextElement.className = 'text-sm text-gray-200 break-words flex-1'; // flex-1 agar teks mengambil ruang
            captionTextElement.textContent = captionText;

            // Tombol Salin (lebih kecil dan rapi)
            const copyCaptionBtn = document.createElement('button');
            copyCaptionBtn.className = 'flex-shrink-0 bg-orange-600 hover:bg-orange-700 text-white text-xs font-medium py-1 px-2 rounded transition-all'; // Styling baru
            copyCaptionBtn.textContent = 'Salin';
            copyCaptionBtn.onclick = () => copyTextToClipboard(captionText, copyCaptionBtn);
            
            // Masukkan teks dan tombol ke dalam kontainer
            captionContainer.appendChild(captionTextElement);
            captionContainer.appendChild(copyCaptionBtn);

            // Kontainer untuk tombol Unduh & Hasilkan Ulang
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'grid grid-cols-2 gap-2 pt-1'; // Tambah pt-1

            const downloadBtn = document.createElement('a');
            downloadBtn.href = imageDataUrl;
            downloadBtn.download = `aivisual_${Date.now()}.png`;
            downloadBtn.textContent = 'Unduh';
            // MODIFIKASI: Menggunakan btn-neon-green
            downloadBtn.className = 'w-full text-center btn btn-neon-green text-sm font-medium py-2 px-3 rounded-md transition-all';
            
            const regenBtn = document.createElement('button');
            regenBtn.textContent = 'Hasilkan Ulang';
            // MODIFIKASI: Menggunakan btn-neon-orange
            regenBtn.className = 'w-full btn btn-neon-orange text-sm font-medium py-2 px-3 rounded-md transition-all';
            regenBtn.onclick = () => handleRegenerate(card);

            const miniLoader = document.createElement('div');
            miniLoader.className = 'mini-loader';

            buttonContainer.appendChild(downloadBtn);
            buttonContainer.appendChild(regenBtn);
            
            card.appendChild(img);
            card.appendChild(captionContainer); // Tambahkan kontainer caption
            card.appendChild(buttonContainer); // Tambahkan kontainer tombol
            card.appendChild(miniLoader);
            resultsContainer.appendChild(card);
        }

        // --- Fungsi Buat Kartu Error ---
        function createErrorCard(promptText) {
            const card = document.createElement('div');
            // MODIFIKASI: Menggunakan glass-card
            card.className = 'relative glass-card p-3 space-y-3 flex flex-col items-center justify-center aspect-square bg-red-900/50 rounded-lg';
            card.setAttribute('data-prompt', promptText);

            card.innerHTML = `<p class="text-red-300 text-center text-sm">Gagal memuat gambar ini.</p>`;
            
            const regenBtn = document.createElement('button');
            regenBtn.textContent = 'Coba Lagi';
            // MODIFIKASI: Menggunakan btn-neon-orange
            regenBtn.className = 'w-full btn btn-neon-orange text-sm font-medium py-2 px-3 rounded-md transition-all mt-4';
            regenBtn.onclick = () => handleRegenerate(card, true); 

            const miniLoader = document.createElement('div');
            miniLoader.className = 'mini-loader';
            
            card.appendChild(regenBtn);
            card.appendChild(miniLoader);
            resultsContainer.appendChild(card);
        }

        // --- Fungsi Handle Regenerate/Retry (DIPERBARUI DENGAN STRUKTUR CAPTION BARU) ---
        async function handleRegenerate(card, isRetry = false) {
            if (!uploadedBase64) {
                showError("Gambar asli tidak ditemukan.");
                return;
            }

            let promptObj;
            let oldCaption = card.getAttribute('data-caption');
            if (isRetry) {
                const storedPromptText = card.getAttribute('data-prompt');
                promptObj = allPrompts.find(p => p.text === storedPromptText);
                if (!promptObj) { 
                    promptObj = { text: storedPromptText, caption: oldCaption || "Gagal memuat caption." };
                }
            } else {
                promptObj = getRandomPrompts(allPrompts, 1)[0];
                card.setAttribute('data-prompt', promptObj.text);
                card.setAttribute('data-caption', promptObj.caption);
            }

            const miniLoader = card.querySelector('.mini-loader');
            const img = card.querySelector('img');
            // MODIFIKASI: Mencari tombol berdasarkan kelas btn
            const regenBtn = card.querySelector('button.btn-neon-orange');
            const captionContainer = card.querySelector('.bg-gray-900\\/50');
            const copyBtn = card.querySelector('.bg-orange-600'); // Tombol salin tetap

            miniLoader.style.display = 'block';
            if (regenBtn) regenBtn.disabled = true;
            if (copyBtn) copyBtn.disabled = true;
            if (img) img.style.opacity = '0.5';
            if (captionContainer) captionContainer.style.opacity = '0.5';
            if (isRetry) {
                const existingP = card.querySelector('p.text-red-300');
                if (existingP) existingP.remove();
            }

            const customWatermarkText = watermarkText.value;

            try {
                const base64Data = await callGeminiApi(promptObj.text, uploadedBase64);
                let finalImageData = `data:image/png;base64,${base64Data}`;

                if (watermarkToggle.checked && customWatermarkText) {
                    finalImageData = await applyWatermark(finalImageData, customWatermarkText);
                }

                if (isRetry && !img) { 
                    card.innerHTML = ''; 
                    // MODIFIKASI: Menggunakan glass-card
                    card.className = 'relative glass-card p-3 space-y-3 rounded-lg'; 
                    // Rekonstruksi kartu dari awal
                    createImageCard(finalImageData, promptObj.text, promptObj.caption); 
                    // Hapus kartu error lama dan ganti dengan yang baru
                    const oldCard = card;
                    const newCard = resultsContainer.lastChild; // Ambil kartu yg baru dibuat
                    oldCard.parentNode.replaceChild(newCard, oldCard);
                } else {
                    if (img) {
                        img.src = finalImageData;
                        img.style.opacity = '1';
                    }
                    const downloadLink = card.querySelector('a[download]');
                    if (downloadLink) downloadLink.href = finalImageData;
                    
                    if (captionContainer) {
                        const captionTextElement = captionContainer.querySelector('p');
                        if (captionTextElement) captionTextElement.textContent = promptObj.caption;
                        captionContainer.style.opacity = '1';
                    }
                    if (copyBtn) {
                        copyBtn.onclick = () => copyTextToClipboard(promptObj.caption, copyBtn);
                    }
                }

            } catch (error) {
                console.error("Gagal regenerasi:", error);
                if (isRetry && !img) { 
                    card.innerHTML = `<p class="text-red-300 text-center text-sm">Gagal memuat gambar ini.</p>`;
                    const newRegenBtn = regenBtn.cloneNode(true); 
                    newRegenBtn.onclick = () => handleRegenerate(card, true);
                    newRegenBtn.disabled = false;
                    card.appendChild(newRegenBtn);
                    card.appendChild(miniLoader.cloneNode(true));
                }
            } finally {
                miniLoader.style.display = 'none';
                // MODIFIKASI: Mencari tombol berdasarkan kelas btn
                const finalRegenBtn = card.querySelector('button.btn-neon-orange');
                if (finalRegenBtn) finalRegenBtn.disabled = false;
                const finalCopyBtn = card.querySelector('.bg-orange-600');
                if (finalCopyBtn) finalCopyBtn.disabled = false; 
            }
        }


        // --- Fungsi Salin Teks ke Clipboard (DIPERBAIKI UNTUK iFRAME) ---
        function copyTextToClipboard(text, buttonElement) {
            // Buat elemen textarea sementara
            const textArea = document.createElement('textarea');
            textArea.value = text;
            
            // Atur agar tidak terlihat
            textArea.style.position = 'fixed';
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = '0';
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            let successful = false;
            try {
                successful = document.execCommand('copy');
            } catch (err) {
                console.error('Gagal menyalin:', err);
            }

            document.body.removeChild(textArea);

            // Update UI tombol
            if (successful) {
                buttonElement.textContent = 'Disalin!';
            } else {
                buttonElement.textContent = 'Gagal!';
            }
            
            setTimeout(() => {
                buttonElement.textContent = 'Salin'; // Kembalikan ke teks asli
            }, 1500);
        }

        // --- Fungsi Tampilkan Error ---
        function showError(message) {
            errorMessage.textContent = message;
        }

    </script>
</body>
</html>